import{a6 as e,a7 as a,R as l,f as s,g as t,h as o,j as d,o as r,L as i,w as c,d as n,a as u,c as _,e as p,t as m,H as f,y as h,au as v,B as y,A as b,D as k,E as g,aa as V}from"./index-BdR_P0jW.js";/* empty css                */import{E as x}from"./index-D1LW7kyL.js";import"./index-SLBSEZ_O.js";const w={key:1,class:"text-red",draggable:"true"},j={__name:"roleForm",props:e({data:{type:Object,default:()=>({})}},{modelValue:{},modelModifiers:{}}),emits:e(["submit"],["update:modelValue"]),setup(e,{emit:j}){const R=a(e,"modelValue"),C=j,O=e,U=l((()=>(O.data.role_id?"编辑":"新增")+"角色")),D=l((()=>O.data.role_id)),E={checkStrictly:!0,label:"role_name",value:"role_id",children:"children"},K=s([]),q=s([]),z={label:"access_name",value:"access_id",children:"children"},A=s(null),B=s(null),F=s(null),H=t({access_list:[]}),L=t({role_name:[{required:!0,message:"请输入名称",trigger:"blur"}]});o(R,(async e=>{if(!e)return void Y(H);const a=D.value??0,l=await d("/admin/role/edit/"+a,{parent_role_id:0});if(!l)return;const{role:s,role_list:t,access_list:o,role_access_ids:r}=l||{};Y(H),Object.assign(H,s),r.push(1),H.access_list=r,K.value=[{role_name:"无",role_id:0,option_index:0}].concat(t),o[0].disabled=!0,q.value=o}));const M=e=>{H.parent_role_id=e.length>0?e[e.length-1]:"",""!==H.parent_role_id?(async e=>{const a=await d("/admin/role/edit/"+e,{parent_role_id:e}),l=(null==a?void 0:a.role_list)||[];K.value=[{role_name:"无",role_id:0,option_index:0}].concat(l),q.value=(null==a?void 0:a.access_list)||[],q.value[0].disabled=!0})(H.parent_role_id):q.value=[]},S=(e,a)=>{F.value=a.halfCheckedKeys,Object.assign(H,{access_list:a.checkedKeys})},Y=e=>{for(const a of Object.keys(e))delete e[a];H.access_list=[]},G=async()=>{let e=[];F.value&&(e=F.value.concat(H.access_list));let a={...H};e.length>0&&(a.access_list=e.sort(((e,a)=>e-a)));await h("/admin/role/edit",a)&&(f.success((O.data.role_id?"修改":"添加")+"成功"),C("submit"),R.value=!1)};return(e,a)=>{const l=v,s=y,t=b,o=x,d=k,h=g,j=V;return r(),i(j,{modelValue:R.value,"onUpdate:modelValue":a[4]||(a[4]=e=>R.value=e),title:U.value,width:"420",top:"20vh",class:"form-dialog","close-on-click-modal":!1},{default:c((()=>[n(h,{ref_key:"formDataRef",ref:B,model:H,"label-width":"auto",rules:L},{default:c((()=>[n(s,{label:"上级权限",prop:"formData.parent_role_id"},{default:c((()=>[n(l,{options:K.value,props:E,modelValue:H.parent_role_id,"onUpdate:modelValue":a[0]||(a[0]=e=>H.parent_role_id=e),clearable:"",onChange:M,style:{width:"100%"}},null,8,["options","modelValue"]),a[5]||(a[5]=u("span",{class:"text-muted"},"父级角色，角色最多三级",-1))])),_:1}),n(s,{label:"名称",prop:"role_name"},{default:c((()=>[n(t,{modelValue:H.role_name,"onUpdate:modelValue":a[1]||(a[1]=e=>H.role_name=e)},null,8,["modelValue"])])),_:1}),n(s,{label:"描述",prop:"description"},{default:c((()=>[n(t,{style:{width:"100%"},modelValue:H.description,"onUpdate:modelValue":a[2]||(a[2]=e=>H.description=e),autosize:{minRows:2,maxRows:4},type:"textarea",placeholder:"请输入描述"},null,8,["modelValue"])])),_:1}),n(s,{label:"权限",prop:"params"},{default:c((()=>[H.parent_role_id||H.parent_role_id>=0?(r(),i(o,{key:0,ref_key:"treeRef",ref:A,data:q.value,"show-checkbox":"","node-key":"access_id","check-strictly":"","default-checked-keys":H.access_list,props:z,onCheck:S},null,8,["data","default-checked-keys"])):(r(),_("span",w,"请选择父级角色"))])),_:1}),n(s,{class:"text-right"},{default:c((()=>[n(d,{type:"primary",onClick:a[3]||(a[3]=e=>(async e=>{e&&e.validate((e=>{if(e){if(!H.access_list.length)return void f({message:"权限分配不能为空",type:"error"});G()}}))})(B.value))},{default:c((()=>[p(" 立即"+m(O.data.role_id?"修改":"添加"),1)])),_:1})])),_:1})])),_:1},8,["model","rules"])])),_:1},8,["modelValue","title"])}}};export{j as default};
