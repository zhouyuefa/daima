import{aC as e,h as t,be as l,bj as a,k as s,ae as o,bk as d,R as n,an as c,ad as r,b3 as u,bd as i,bl as h,bm as p,bn as v,bc as f,bo as k,O as C,bp as y,bq as b,f as m,g as N,S as g,b0 as K,aO as x,aP as O}from"./index-BdR_P0jW.js";import{E}from"./index-D1LW7kyL.js";const V=c({extends:r,setup(e,a){const s=r.setup(e,a);delete s.selectOptionClick;const o=u().proxy;return l((()=>{s.select.states.cachedOptions.get(o.value)||s.select.onOptionCreate(o)})),t((()=>a.attrs.visible),(e=>{s.states.visible=e}),{immediate:!0}),s},methods:{selectOptionClick(){this.$el.parentElement.click()}}});function S(e){return e||0===e}function M(e){return i(e)&&e.length}function j(e){return i(e)?e:S(e)?[e]:[]}function A(e,t,l,a,s){for(let o=0;o<e.length;o++){const d=e[o];if(t(d,o,e,s))return a?a(d,o,e,s):d;{const e=l(d);if(M(e)){const s=A(e,t,l,a,d);if(s)return s}}}}function w(e,t,l,a){for(let s=0;s<e.length;s++){const o=e[s];t(o,s,e,a);const d=l(o);M(d)&&w(d,t,l,o)}}var H=c({props:{data:{type:Array,default:()=>[]}},setup(e){const l=C(y);return t((()=>e.data),(()=>{var t;e.data.forEach((e=>{l.states.cachedOptions.has(e.value)||l.states.cachedOptions.set(e.value,e)}));const a=(null==(t=l.selectRef)?void 0:t.querySelectorAll("input"))||[];b&&!Array.from(a).includes(document.activeElement)&&l.setSelected()}),{flush:"post",immediate:!0}),()=>{}}});const L=O(x(c({name:"ElTreeSelect",inheritAttrs:!1,props:{...o.props,...E.props,cacheData:{type:Array,default:()=>[]}},setup(c,r){const{slots:u,expose:i}=r,C=m(),y=m(),b=n((()=>c.nodeKey||c.valueKey||"value")),x=((c,{attrs:r,emit:u},{select:i,tree:h,key:p})=>{const v=e("tree-select");return t((()=>c.data),(()=>{c.filterable&&l((()=>{var e,t;null==(t=h.value)||t.filter(null==(e=i.value)?void 0:e.states.inputValue)}))}),{flush:"post"}),{...a(s(c),Object.keys(o.props)),...r,"onUpdate:modelValue":e=>u(d,e),valueKey:p,popperClass:n((()=>{const e=[v.e("popper")];return c.popperClass&&e.push(c.popperClass),e.join(" ")})),filterMethod:(e="")=>{var t;c.filterMethod?c.filterMethod(e):c.remoteMethod?c.remoteMethod(e):null==(t=h.value)||t.filter(e)}}})(c,r,{select:C,tree:y,key:b}),{cacheOptions:O,...L}=((e,{attrs:o,slots:c,emit:r},{select:u,tree:i,key:C})=>{t((()=>e.modelValue),(()=>{e.showCheckbox&&l((()=>{const t=i.value;t&&!h(t.getCheckedKeys(),j(e.modelValue))&&t.setCheckedKeys(j(e.modelValue))}))}),{immediate:!0,deep:!0});const y=n((()=>({value:C.value,label:"label",children:"children",disabled:"disabled",isLeaf:"isLeaf",...e.props}))),b=(e,t)=>{var l;const a=y.value[e];return v(a)?a(t,null==(l=i.value)?void 0:l.getNode(b("value",t))):t[a]},m=j(e.modelValue).map((t=>A(e.data||[],(e=>b("value",e)===t),(e=>b("children",e)),((e,t,l,a)=>a&&b("value",a))))).filter((e=>S(e))),N=n((()=>{if(!e.renderAfterExpand&&!e.lazy)return[];const t=[];return w(e.data.concat(e.cacheData),(e=>{const l=b("value",e);t.push({value:l,currentLabel:b("label",e),isDisabled:b("disabled",e)})}),(e=>b("children",e))),t})),g=()=>{var e;return null==(e=i.value)?void 0:e.getCheckedKeys().filter((e=>{var t;const l=null==(t=i.value)?void 0:t.getNode(e);return!f(l)&&k(l.childNodes)}))};return{...a(s(e),Object.keys(E.props)),...o,nodeKey:C,expandOnClickNode:n((()=>!e.checkStrictly&&e.expandOnClickNode)),defaultExpandedKeys:n((()=>e.defaultExpandedKeys?e.defaultExpandedKeys.concat(m):m)),renderContent:(t,{node:l,data:a,store:s})=>t(V,{value:b("value",a),label:b("label",a),disabled:b("disabled",a),visible:l.visible},e.renderContent?()=>e.renderContent(t,{node:l,data:a,store:s}):c.default?()=>c.default({node:l,data:a,store:s}):void 0),filterNodeMethod:(t,l,a)=>e.filterNodeMethod?e.filterNodeMethod(t,l,a):!t||new RegExp(p(t),"i").test(b("label",l)||""),onNodeClick:(t,l,a)=>{var s,d,n,c;if(null==(s=o.onNodeClick)||s.call(o,t,l,a),!e.showCheckbox||!e.checkOnClickNode){if(e.showCheckbox||!e.checkStrictly&&!l.isLeaf)e.expandOnClickNode&&a.proxy.handleExpandIconClick();else if(!b("disabled",t)){const e=null==(d=u.value)?void 0:d.states.options.get(b("value",t));null==(n=u.value)||n.handleOptionSelect(e)}null==(c=u.value)||c.focus()}},onCheck:(t,a)=>{var s;if(!e.showCheckbox)return;const n=b("value",t),c={};w([i.value.store.root],(e=>c[e.key]=e),(e=>e.childNodes));const h=a.checkedKeys,p=e.multiple?j(e.modelValue).filter((e=>!(e in c)&&!h.includes(e))):[],v=p.concat(h);if(e.checkStrictly)r(d,e.multiple?v:v.includes(n)?n:void 0);else if(e.multiple){const e=g();r(d,p.concat(e))}else{const l=A([t],(e=>!M(b("children",e))&&!b("disabled",e)),(e=>b("children",e))),a=l?b("value",l):void 0,s=S(e.modelValue)&&!!A([t],(t=>b("value",t)===e.modelValue),(e=>b("children",e)));r(d,a===e.modelValue||s?void 0:a)}l((()=>{var l;const a=j(e.modelValue);i.value.setCheckedKeys(a),null==(l=o.onCheck)||l.call(o,t,{checkedKeys:i.value.getCheckedKeys(),checkedNodes:i.value.getCheckedNodes(),halfCheckedKeys:i.value.getHalfCheckedKeys(),halfCheckedNodes:i.value.getHalfCheckedNodes()})})),null==(s=u.value)||s.focus()},onNodeExpand:(t,a,s)=>{var n;null==(n=o.onNodeExpand)||n.call(o,t,a,s),l((()=>{if(!e.checkStrictly&&e.lazy&&e.multiple&&a.checked){const t={},l=i.value.getCheckedKeys();w([i.value.store.root],(e=>t[e.key]=e),(e=>e.childNodes));const a=j(e.modelValue).filter((e=>!(e in t)&&!l.includes(e))),s=g();r(d,a.concat(s))}}))},cacheOptions:N}})(c,r,{select:C,tree:y,key:b}),D=N({});return i(D),g((()=>{Object.assign(D,{...a(y.value,["filter","updateKeyChildren","getCheckedNodes","setCheckedNodes","getCheckedKeys","setCheckedKeys","setChecked","getHalfCheckedNodes","getHalfCheckedKeys","getCurrentKey","getCurrentNode","setCurrentKey","setCurrentNode","getNode","remove","append","insertBefore","insertAfter"]),...a(C.value,["focus","blur"])})})),()=>K(o,N({...x,ref:e=>C.value=e}),{...u,default:()=>[K(H,{data:O.value}),K(E,N({...L,ref:e=>y.value=e}))]})}}),[["__file","tree-select.vue"]]));export{L as E};
