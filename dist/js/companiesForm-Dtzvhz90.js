import{_ as e,a6 as a,a7 as l,R as d,f as s,g as t,al as i,h as o,j as r,r as u,o as n,c as p,d as m,w as c,a as _,e as f,L as b,l as v,i as g,t as y,J as V,H as w,y as h,A as k,B as q,z as U,af as j,D as x,E as C,aa as O,bS as R}from"./index-BdR_P0jW.js";/* empty css                    */import{E as P}from"./index-TSZus3Mb.js";const z={key:0,style:{display:"flex"}},F={style:{width:"50%"}},L={style:{width:"50%"},class:"ml20"},S={key:1,style:{display:"flex"}},D={style:{width:"50%"}},E={style:{width:"50%"},class:"ml20"},G={style:{display:"flex"}},J={style:{width:"50%"}},B={style:{width:"50%"},class:"ml20"},I={style:{display:"flex"}},M={style:{width:"50%"}},A={style:{width:"50%"},class:"ml20"},H={class:"upload-file"},N={class:"upload-file-name"},T=e({__name:"companiesForm",props:a({data:{type:Object,default:()=>({})}},{modelValue:{},modelModifiers:{}}),emits:a(["submit"],["update:modelValue"]),setup(e,{emit:a}){const T=l(e,"modelValue"),Z=a,W=e,X=d((()=>(W.data.admin_user_id?"编辑":"新增")+"汽车公司")),K=d((()=>W.data.admin_user_id)),Q=s(null),Y=t({}),$=s({}),ee=s([]);s(["Value selected and disabled","Value A"]);const ae=s(i+"/upload/file"),le=s([]);s([]);const de=s(null),se=e=>{"application/pdf"===e.type?$.value={file_type:"pdf"}:e.type.includes("image")?$.value={file_type:"image"}:$.value={}},te=t({password:[{required:!0,message:"请输入密码",trigger:"blur"}],repeat_password:[{required:!0,message:"请输入密码",trigger:"blur"}],real_name:[{required:!0,message:"请输入公司名称",trigger:"blur"}],bank_name:[{required:!0,message:"请输入公司全称/账户名",trigger:"blur"}],bank:[{required:!0,message:"请输入开户行",trigger:"blur"}],branch:[{required:!0,message:"请输入支行",trigger:"blur"}],address:[{required:!0,message:"请输入公司地址",trigger:"blur"}],account_type:[{required:!0,message:"请输入账户类型",trigger:"blur"}],account_number:[{required:!0,message:"请输入账户号",trigger:"blur"}],swift_code:[{required:!0,message:"请输入swift_code",trigger:"blur"}],contact_person:[{required:!0,message:"请输入联系人",trigger:"blur"}],contact_phone:[{required:!0,message:"请输入联系电话",trigger:"blur"}],email:[{required:!0,message:"请输入email",trigger:"blur"}],required_documents:[{required:!0,message:"请输入需提供上传的资料",trigger:"blur"}]});o(T,(async e=>{if(!e)return ie(Y),void de.value.clearFiles();const a=K.value??0,l=await r("/admin/companies/edit/"+a);if(!l)return;const{info:d}=l||{};ie(Y),le.value=d.required_documents_list,Object.assign(Y,d)})),o(le,(e=>{const a=document.querySelector("#upload .el-upload--picture-card");a&&e&&(e.length>=10?a.style.display="none":a.style.display="inline-flex")}),{deep:!0});const ie=e=>{for(const a of Object.keys(e))delete e[a]},oe=()=>{ee.value=[]},re=()=>{Q.value.resetFields(),Q.value.clearValidate(["email","password","repeat_password"])},ue=e=>{var a;if("image"===(e.file_type||(null==(a=null==e?void 0:e.response)?void 0:a.data.file_type)))return void(ee.value=[e.url]);const l=new XMLHttpRequest;l.open("get",e.url),l.responseType="blob",l.send(),l.onload=function(){if(200===this.status||304===this.status){if("msSaveOrOpenBlob"in navigator)return void navigator.msSaveOrOpenBlob(this.response,name);const e=URL.createObjectURL(this.response);window.open(e)}}},ne=async()=>{if(Y.password!==Y.repeat_password)return void w({message:"两次密码输入不一致",type:"warning"});let e=[];le.value.map((a=>{a.file_id&&e.push(a.file_id),a.response&&a.response.data.id&&e.push(a.response.data.id)})),Y.required_documents=e.join(",");await h("/admin/companies/edit",{...Y,role_id:2})&&(w.success((W.data.admin_user_id?"修改":"添加")+"成功"),Z("submit"),T.value=!1)},pe=(e,a)=>{},me=e=>{200!==e.code&&(w({message:e.msg,type:"error"}),de.value.handleRemove(e))};return(e,a)=>{const l=k,d=q,s=u("Plus"),t=U,i=j,o=u("ZoomIn"),r=u("Delete"),w=P,h=x,Z=C,K=O,ie=R;return n(),p(V,null,[m(K,{modelValue:T.value,"onUpdate:modelValue":a[16]||(a[16]=e=>T.value=e),title:X.value,width:"860",top:"8vh",class:"form-dialog","close-on-click-modal":!1,onClose:re},{default:c((()=>[m(Z,{ref_key:"formDataRef",ref:Q,model:Y,"label-width":"auto",rules:te},{default:c((()=>[a[19]||(a[19]=_("div",{class:"title"},"账号信息",-1)),0!==W.data.admin_user_id?(n(),p("div",z,[_("div",F,[m(d,{label:"登录账号",prop:"username"},{default:c((()=>[m(l,{modelValue:Y.username,"onUpdate:modelValue":a[0]||(a[0]=e=>Y.username=e),style:{width:"100%"},disabled:""},null,8,["modelValue"])])),_:1})]),_("div",L,[m(d,{label:"邮箱",prop:0==W.data.admin_user_id?"email":""},{default:c((()=>[m(l,{modelValue:Y.email,"onUpdate:modelValue":a[1]||(a[1]=e=>Y.email=e),disabled:0!=W.data.admin_user_id},null,8,["modelValue","disabled"])])),_:1},8,["prop"])])])):(n(),p("div",S,[_("div",D,[m(d,{label:"邮箱",prop:0==W.data.admin_user_id?"email":""},{default:c((()=>[m(l,{modelValue:Y.email,"onUpdate:modelValue":a[2]||(a[2]=e=>Y.email=e),disabled:0!=W.data.admin_user_id},null,8,["modelValue","disabled"])])),_:1},8,["prop"]),m(d,{label:"确认密码",prop:0==W.data.admin_user_id?"repeat_password":""},{default:c((()=>[m(l,{modelValue:Y.repeat_password,"onUpdate:modelValue":a[3]||(a[3]=e=>Y.repeat_password=e),type:"password",disabled:0!=W.data.admin_user_id},null,8,["modelValue","disabled"])])),_:1},8,["prop"])]),_("div",E,[m(d,{label:"密码",prop:0==W.data.admin_user_id?"password":""},{default:c((()=>[m(l,{modelValue:Y.password,"onUpdate:modelValue":a[4]||(a[4]=e=>Y.password=e),type:"password",autocomplete:"new-password",disabled:0!=W.data.admin_user_id},null,8,["modelValue","disabled"])])),_:1},8,["prop"])])])),a[20]||(a[20]=_("div",{class:"title"},"基本信息",-1)),_("div",G,[_("div",J,[m(d,{label:"公司名称",prop:"real_name"},{default:c((()=>[m(l,{modelValue:Y.real_name,"onUpdate:modelValue":a[5]||(a[5]=e=>Y.real_name=e),style:{width:"100%"}},null,8,["modelValue"])])),_:1}),m(d,{label:"联系电话",prop:"contact_phone"},{default:c((()=>[m(l,{modelValue:Y.contact_phone,"onUpdate:modelValue":a[6]||(a[6]=e=>Y.contact_phone=e),maxlength:"11"},null,8,["modelValue"])])),_:1})]),_("div",B,[m(d,{label:"公司地址",prop:"address"},{default:c((()=>[m(l,{modelValue:Y.address,"onUpdate:modelValue":a[7]||(a[7]=e=>Y.address=e)},null,8,["modelValue"])])),_:1})])]),a[21]||(a[21]=_("div",{class:"title"},"财务信息",-1)),_("div",I,[_("div",M,[m(d,{label:"公司全称/账户名",prop:"bank_name"},{default:c((()=>[m(l,{modelValue:Y.bank_name,"onUpdate:modelValue":a[8]||(a[8]=e=>Y.bank_name=e),style:{width:"100%"}},null,8,["modelValue"])])),_:1}),m(d,{label:"开户银行",prop:"bank"},{default:c((()=>[m(l,{modelValue:Y.bank,"onUpdate:modelValue":a[9]||(a[9]=e=>Y.bank=e)},null,8,["modelValue"])])),_:1}),m(d,{label:"SWIFT Code",prop:"swift_code"},{default:c((()=>[m(l,{modelValue:Y.swift_code,"onUpdate:modelValue":a[10]||(a[10]=e=>Y.swift_code=e)},null,8,["modelValue"])])),_:1})]),_("div",A,[m(d,{label:"银行账号",prop:"account_number"},{default:c((()=>[m(l,{modelValue:Y.account_number,"onUpdate:modelValue":a[11]||(a[11]=e=>Y.account_number=e)},null,8,["modelValue"])])),_:1}),m(d,{label:"支店",prop:"branch"},{default:c((()=>[m(l,{modelValue:Y.branch,"onUpdate:modelValue":a[12]||(a[12]=e=>Y.branch=e)},null,8,["modelValue"])])),_:1})])]),_("div",null,[a[17]||(a[17]=_("div",{class:"title"},[f(" 附件 "),_("span",{style:{"font-size":"12px"}},"（支持JPG、PNG、PDF格式，文件大小不超过2M）")],-1)),m(w,{ref_key:"uploadRef",ref:de,id:"upload",limit:10,multiple:"","file-list":le.value,"onUpdate:fileList":a[13]||(a[13]=e=>le.value=e),action:ae.value,"list-type":"picture-card","on-remove":pe,accept:"image/PNG,image/JPEG,.pdf",data:$.value,"before-upload":se,"on-success":me},{file:c((({file:e})=>{var a,l,d;return["pdf"===(e.file_type||(null==(a=null==e?void 0:e.response)?void 0:a.data.file_type))?(n(),b(i,{key:0,src:v("/jpeg/pdf-CJCEZzb0.jpeg")},null,8,["src"])):"image"===(e.file_type||(null==(l=null==e?void 0:e.response)?void 0:l.data.file_type))?(n(),b(i,{key:1,src:e.url||(null==(d=e.response)?void 0:d.data.file_url),fit:"contain"},null,8,["src"])):g("",!0),_("div",H,[m(t,{class:"upload-file-function",onClick:a=>ue(e),size:"20"},{default:c((()=>[m(o)])),_:2},1032,["onClick"]),m(t,{class:"upload-file-function",onClick:a=>(e=>{de.value.handleRemove(e)})(e),size:"20"},{default:c((()=>[m(r)])),_:2},1032,["onClick"]),_("span",N,y(e.name||e.file_name),1)])]})),default:c((()=>[m(t,null,{default:c((()=>[m(s)])),_:1})])),_:1},8,["file-list","action","data"])]),m(d,{class:"text-right mt20"},{default:c((()=>[m(h,{type:"primary",onClick:a[14]||(a[14]=e=>(async e=>{e&&e.validate((e=>{e&&ne()}))})(Q.value))},{default:c((()=>[f(" 立即"+y(W.data.admin_user_id?"修改":"添加"),1)])),_:1}),m(h,{onClick:a[15]||(a[15]=e=>(Q.value,Y.real_name="",Y.address="",Y.contact_phone="",Y.bank_name="",Y.account_number="",Y.bank="",Y.branch="",Y.swift_code="",Y.required_documents="",void(le.value=[])))},{default:c((()=>a[18]||(a[18]=[f(" 重置 ")]))),_:1})])),_:1})])),_:1},8,["model","rules"])])),_:1},8,["modelValue","title"]),ee.value.length?(n(),b(ie,{key:0,"url-list":ee.value,"hide-on-click-modal":"","close-on-press-escape":"",teleported:"",onClose:oe},null,8,["url-list"])):g("",!0)],64)}}},[["__scopeId","data-v-0331e2ba"]]);export{T as default};
