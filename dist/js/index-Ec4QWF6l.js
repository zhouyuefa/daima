import{at as e,f as a,g as l,T as t,y as i,ai as n,S as s,r as o,o as r,c as d,F as u,a2 as p,a as c,d as m,w as h,e as v,t as g,an as b,H as _,aw as y,D as w,aa as f,A as x,B as W,E as j}from"./index-BdR_P0jW.js";/* empty css                *//* empty css                                                                 */import k from"./add-DaLrd7L2.js";import V from"./shopCheck-D51HXPt2.js";import{E as C}from"./index-C5CR2e01.js";/* empty css                */import"./index-PFFTJ-rA.js";/* empty css                    */import"./index-TSZus3Mb.js";import"./index-DIDL6cCO.js";import"./index-C5ggMqbd.js";const P={class:"boxElMain"},D={class:"box boxFlex"},S={class:"dialog-footer"},O={class:"dialog-footer"},H=b({name:"localLife/shopmanager/index"}),R=Object.assign(H,{setup(b){e((()=>{}));const H=a({getList:"/admin/merchant/index/list",save_submit:"/admin/merchant/index/edit_save",getDetail:"/admin/merchant/index/detail",checkShop:"/admin/merchant/index/audit",update_recommend:"/admin/merchant/index/tuijian",updatePassword:"/admin/merchant/index/password"}),R=l({}),E=a([{label:"全部",value:"all"},{label:"启用",value:"1"},{label:"禁用",value:"2"}]),F=a([{label:"是",value:1},{label:"否",value:0}]),U=a([]);(async()=>{const e=await i("/admin/merchant/type/tree_list");U.value=(null==e?void 0:e.map((e=>{var a;return(null==(a=e.children)?void 0:a.length)>0&&(e.children=e.children.map((e=>({value:e.key,label:e.name})))),{value:e.key,label:e.name,children:e.children}})))||[]})();const J=a([{type:"Input",label:"商户名称",prop:"keyword",placeholder:"请输入",width:"180px"},{type:"cascader",label:"商户类型",prop:"merchant_type",placeholder:"请选择",width:"180px",options:U},{type:"Select",label:"状态",prop:"status",width:"180px",options:E,placeholder:"请选择状态"},{type:"Select",label:"是否推荐",prop:"is_tuijian",width:"180px",options:F,placeholder:"请选择"}]),L=a({id:"",merchant_type:"",status:"all",keyword:""}),N=a([{label:"查 询",icon:"Search",auth:"admin/merchant/index/list",handle:()=>B()},{label:"重置",auth:"admin/merchant/index/list",handle:()=>se()},{label:"排序",popover:!0}]),T=a([{label:"新增",icon:"Plus",handle:()=>$(),auth:"admin/merchant/index/edit_save"}]),z=a({page:1,page_size:20}),A=a([{label:"ID",prop:"id",align:"center",type:"string",sortable:!1,minWidth:"80",show:!0},{label:"商户编号",prop:"merchant_no",align:"center",type:"string",sortable:!1,minWidth:"120",show:!0},{label:"商户类型",prop:"type_text",align:"center",type:"string",sortable:!1,minWidth:"150",show:!0},{label:"商户头像",prop:"logo_img_url",align:"center",type:"image",imgWidth:"35px",sortable:!1,minWidth:"120",show:!0},{label:"商户名称",prop:"name",align:"center",type:"string",sortable:!1,minWidth:"120",show:!0},{label:"副标题",prop:"subtitle",align:"center",type:"string",sortable:!1,minWidth:"120",show:!0},{label:"都道府县",prop:"province_name",align:"center",type:"string",sortable:!1,minWidth:"120",show:!0},{label:"市区町村",prop:"city_name",align:"center",type:"string",sortable:!1,minWidth:"120",show:!0},{label:"详细地址",prop:"address",align:"center",type:"string",sortable:!1,minWidth:"120",show:!0},{label:"服务电话",prop:"mobile",align:"center",type:"string",sortable:!1,minWidth:"120",show:!0},{label:"评分",prop:"grade",align:"center",type:"string",sortable:!1,minWidth:"80",show:!0},{label:"用户端账号",prop:"user_id",align:"center",type:"string",sortable:!1,minWidth:"120",show:!0},{label:"登录账号",prop:"login_name",align:"center",type:"string",sortable:!1,minWidth:"120",show:!0},{label:"状态",prop:"status_text",align:"center",type:"string",sortable:!1,minWidth:"110",show:!0},{label:"推荐",prop:"is_tuijian",align:"center",type:"switch",sortable:!1,minWidth:"110",show:!0,change:e=>{te(e)},values:[1,0]},{label:"操作",minWidth:"220",type:"button",show:!0,fixed:"right",align:"right",btnList:[{label:"审核",type:"default",auth:"admin/merchant/index/audit",hide:e=>Q(e),handle:(e,a,l,t,i)=>G(e,a)},{label:"编辑",type:"primary",auth:"admin/merchant/index/edit_save",handle:(e,a,l,t,i)=>M(e,a)},{label:"修改密码",type:"warning",auth:"admin/merchant/index/password",handle:(e,a,l,t,i)=>re(e,a)}]}]);t.on("getCheckData",(e=>{(e=>{const a=[];e.list.forEach((e=>{a.push(e.label)})),A.value.sort(((e,l)=>"操作"===e.label?1:a.indexOf(e.label)-a.indexOf(l.label))),A.value=A.value.map((a=>e.data.includes(a.label)||"操作"===a.label?{...a,show:!0}:{...a,show:!1}))})(e)}));const B=()=>{z.value.page=1,le()},I=e=>{for(const a of Object.keys(e))delete e[a]},M=(e,a,l,t,i)=>{Y.value="编辑商户",I(R),Z(a.id,"notcheck")},Z=async(e,a)=>{const l=await i(H.value.getDetail,{id:e});l&&(l.banner_img_url[0]||(l.banner_img_url=[]),l.material_img_url[0]||(l.material_img_url=[]),Object.assign(R,l),X.value="notcheck"===a,q.value="notcheck"!==a)},q=a(!1),G=(e,a,l,t,i)=>{I(R),Z(a.id,"check")},K=async e=>{if(!e)return void(q.value=!1);let a={id:R.id,status:e.status,remark:e.remark};await i(H.value.checkShop,a)&&(q.value=!1,le())},Q=e=>1===e.status,X=a(!1),Y=a(""),$=()=>{I(R),Y.value="新增商户",X.value=!0},ee=async e=>{var a,l;if(!e)return void(X.value=!1);let t=JSON.parse(JSON.stringify(e));t.logo_img=e.logo_img.id||e.logo_img_url.file_id,t.banner_img=null==(a=null==e?void 0:e.banner_img)?void 0:a.map((e=>e.id||e.file_id)),t.material_img=null==(l=null==e?void 0:e.material_img)?void 0:l.map((e=>e.id||e.file_id)),"object"==typeof(null==e?void 0:e.merchant_type)&&1===(null==e?void 0:e.merchant_type.length)?t.merchant_type=null==t?void 0:t.merchant_type[0]:"object"==typeof(null==e?void 0:e.merchant_type)&&(null==e?void 0:e.merchant_type.length)>1&&(t.merchant_type=null==t?void 0:t.merchant_type[1]),await i(H.value.save_submit,t)&&(X.value=!1,le())},ae=a([]),le=async()=>{let e=JSON.parse(JSON.stringify(L.value));"object"==typeof(null==e?void 0:e.merchant_type)&&1===(null==e?void 0:e.merchant_type.length)?e.merchant_type=null==e?void 0:e.merchant_type[0]:"object"==typeof(null==e?void 0:e.merchant_type)&&(null==e?void 0:e.merchant_type.length)>1&&(e.merchant_type=null==e?void 0:e.merchant_type[1]);const a=await i(H.value.getList,{...z.value,...e});if(a&&(ae.value=[],z.value.total=a.page.total||0,ae.value.splice(0),a.list.length>0))for(let l=0;l<a.list.length;l++){let e=a.list[l];ae.value.push(e)}},te=async e=>{let a={id:e.id};a&&a.id&&n.alert("确定修改此商家的推荐状态吗？","提示",{confirmButtonText:"确定",callback:async e=>{if("confirm"===e){await i(H.value.update_recommend,a)&&le()}else le()}})},ie=a(!1),ne=()=>{ie.value=!1};s((()=>{le()}));const se=()=>{I(L.value),L.value.status="all",z.value.page=1,z.value.page_size=20,z.value.parent_key="all",le()},oe=a(!1),re=(e,a)=>{I(R),Object.assign(R,a),de.value.newPassWord="",oe.value=!0},de=a({newPassWord:""}),ue=async()=>{if(""===de.value.newPassWord)return void _.error("请输入新密码");let e={};e={id:R.id,password:de.value.newPassWord};await i(H.value.updatePassword,e)&&(_.success("修改成功"),oe.value=!1)};return(e,a)=>{const l=y,t=o("cusTable"),i=C,n=w,s=f,b=x,_=W,H=j;return r(),d("div",null,[u(c("div",P,[c("div",D,[m(i,null,{default:h((()=>[m(l,{searchForm:J.value,searchData:L.value,searchHandleRight:T.value,searchHandle:N.value,tableCols:A.value,onHandleEnterSearch:B,onHandleReset:se},null,8,["searchForm","searchData","searchHandleRight","searchHandle","tableCols"]),m(t,{ref:"cusTable",height:"calc(100vh - 240px)","row-key":"id",isPagination:!0,isHandle:!0,tableCols:A.value,tableData:ae.value,tablePage:z.value,onHandleCurrentChange:le},null,8,["tableCols","tableData","tablePage"])])),_:1})]),m(s,{modelValue:ie.value,"onUpdate:modelValue":a[1]||(a[1]=e=>ie.value=e),title:"提示",width:"500"},{footer:h((()=>[c("div",S,[m(n,{onClick:a[0]||(a[0]=e=>ie.value=!1)},{default:h((()=>a[7]||(a[7]=[v("取消")]))),_:1}),m(n,{type:"primary",onClick:ne},{default:h((()=>a[8]||(a[8]=[v(" 确定 ")]))),_:1})])])),default:h((()=>[c("span",null,"确定要"+g(1===R.status?"禁用":"启用")+"该商户吗",1)])),_:1},8,["modelValue"])],512),[[p,!(X.value||q.value)]]),m(k,{modelValue:X.value,"onUpdate:modelValue":a[2]||(a[2]=e=>X.value=e),onCloseAddPage:ee,title:Y.value,selectedRowData:R},null,8,["modelValue","title","selectedRowData"]),m(V,{modelValue:q.value,"onUpdate:modelValue":a[3]||(a[3]=e=>q.value=e),onCloseCheckPage:K,selectedRowData:R},null,8,["modelValue","selectedRowData"]),m(s,{modelValue:oe.value,"onUpdate:modelValue":a[6]||(a[6]=e=>oe.value=e),title:"提示",width:"500"},{footer:h((()=>[c("div",O,[m(n,{onClick:a[5]||(a[5]=e=>oe.value=!1)},{default:h((()=>a[9]||(a[9]=[v("取消")]))),_:1}),m(n,{type:"primary",onClick:ue},{default:h((()=>a[10]||(a[10]=[v(" 确定 ")]))),_:1})])])),default:h((()=>[m(H,{ref:"formValidateRef",rules:e.ruleValidate,model:de.value,"label-width":"130px"},{default:h((()=>[m(_,{label:"请输入新密码：",prop:"newPassWord"},{default:h((()=>[m(b,{modelValue:de.value.newPassWord,"onUpdate:modelValue":a[4]||(a[4]=e=>de.value.newPassWord=e),placeholder:"请输入"},null,8,["modelValue"])])),_:1})])),_:1},8,["rules","model"])])),_:1},8,["modelValue"])])}}});export{R as default};
