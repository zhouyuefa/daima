import{_ as e,u as a,f as s,g as l,h as o,c as r,d,w as t,i as n,j as u,k as i,E as p,o as m,a as c,l as f,m as g,n as v,p as _,q as y,e as w,s as b,v as h,x as V,y as x,z as C,A as k,B as M,C as U,D as q}from"./index-BdR_P0jW.js";const I={class:"login"},j={class:"login-code"},z=["src"],K={key:0},A={key:1},B={key:0,style:{float:"right"}},D=e(Object.assign({name:"Login"},{__name:"login",setup(e){const D=h(),E=V(),F=a(),L=s(null),O=s(""),R=s(!1),G=s(!0),H=s(""),J=l({username:"",password:"",rememberMe:!0,validCode:""}),N={username:[{required:!0,trigger:"blur",message:"请输入您的用户名"}],password:[{required:!0,trigger:"blur",message:"请输入您的密码"}],validCode:[{required:!0,trigger:"change",message:"请输入验证码"}]};o((()=>D.query),(e=>{H.value=e.redirect}),{immediate:!0,deep:!0});const P=async()=>{const e=await u("/admin/passport/getcode"),{code:a}=e;O.value="data:image/png;base64,"+a},Q=()=>{const{username:e,password:a,rememberMe:s}=i(J),{username:l,password:o,rememberMe:r}=F.getUserInfo();e.value=l,a.value=o,s.value=r},S=async()=>{await L.value.validate((async(e,a)=>{if(!e)return;R.value=!0;const{username:s,password:l,rememberMe:o,validCode:r}=J,d=await x("/admin/passport/login",{username:s,password:l,valid_code:r});d&&(o?await F.setUserInfo({username:s,password:l,rememberMe:o,authorization:d.status}):F.clearUserInfo(),E.replace(H.value||"/dashboard")),R.value=!1}))};return P(),Q(),(e,a)=>{const s=C,l=k,o=M,u=U,i=q,h=p;return m(),r("div",I,[d(h,{ref_key:"loginFormRef",ref:L,model:J,rules:N,class:"login-form"},{default:t((()=>[a[5]||(a[5]=c("h3",{class:"title"},"都可道 - 平台管理",-1)),d(o,{prop:"username"},{default:t((()=>[d(l,{modelValue:J.username,"onUpdate:modelValue":a[0]||(a[0]=e=>J.username=e),type:"text",placeholder:"用户名"},{prefix:t((()=>[d(s,{class:"el-input__icon input-icon"},{default:t((()=>[d(f(g))])),_:1})])),_:1},8,["modelValue"])])),_:1}),d(o,{prop:"password"},{default:t((()=>[d(l,{modelValue:J.password,"onUpdate:modelValue":a[1]||(a[1]=e=>J.password=e),type:"password","auto-complete":"off",placeholder:"密码",onKeyup:v(S,["enter"])},{prefix:t((()=>[d(s,{class:"el-input__icon input-icon"},{default:t((()=>[d(f(_))])),_:1})])),_:1},8,["modelValue"])])),_:1}),d(o,{prop:"validCode"},{default:t((()=>[d(l,{modelValue:J.validCode,"onUpdate:modelValue":a[2]||(a[2]=e=>J.validCode=e),"auto-complete":"off",placeholder:"验证码",style:{width:"63%"},onKeyup:v(S,["enter"])},{prefix:t((()=>[d(s,{class:"el-input__icon input-icon"},{default:t((()=>[d(f(y))])),_:1})])),_:1},8,["modelValue"]),c("div",j,[c("img",{src:O.value,onClick:P,class:"login-code-img"},null,8,z)])])),_:1}),d(u,{modelValue:J.rememberMe,"onUpdate:modelValue":a[3]||(a[3]=e=>J.rememberMe=e),style:{margin:"0px 0px 25px 0px"}},{default:t((()=>a[4]||(a[4]=[w("记住密码")]))),_:1},8,["modelValue"]),d(o,{style:{width:"100%"}},{default:t((()=>[d(i,{loading:R.value,type:"primary",style:{width:"100%"},onClick:b(S,["prevent"])},{default:t((()=>[R.value?(m(),r("span",A,"登 录 中...")):(m(),r("span",K,"登 录"))])),_:1},8,["loading"]),G.value?(m(),r("div",B)):n("",!0)])),_:1})])),_:1},8,["model"]),n("",!0)])}}}),[["__scopeId","data-v-08a827ef"]]);export{D as default};
