import{_ as e,x as a,f as t,j as l,g as r,y as s,T as i,S as n,ai as o,H as p,r as d,o as c,c as u,a as h,d as b,w as m,e as _,J as g,K as v,t as y,ag as w,aw as f,D as x,aa as W}from"./index-BdR_P0jW.js";/* empty css                */import{E as T}from"./index-C5CR2e01.js";const k={class:"boxElMain"},D={class:"box boxFlex"},C={class:"detail-order"},I={class:"field-label"},H={class:"dialog-footer"},N=e({__name:"index",setup(e){const N=a(),{CHAT_TYPE:j}=w,E=t({getList:"/admin/merchant/order/sub_order_list"}),S=t([{label:"全部",value:"all"},{label:"待支付",value:"1"},{label:"待确认",value:"2"},{label:"待核销",value:"3"},{label:"待评价",value:"4"},{label:"已完成",value:"5"},{label:"已取消",value:"6"},{label:"已退款",value:"7"}]),F=e=>{for(const a of Object.keys(e))delete e[a]},P=t([]);(async()=>{const e=await s("/admin/merchant/type/list",{page:1,page_size:1e4,status:"all",parent_key:"all"});e&&(P.value.splice(0),e.list.map((e=>{P.value.push({value:e.key,label:e.name})})))})();const L=t([{type:"Select",label:"商户类型",prop:"merchant_type",placeholder:"请输入",width:"180px",options:P},{type:"Input",label:"商户名称",prop:"merchant_name",placeholder:"请输入",width:"180px"},{type:"Input",label:"商品名称",prop:"goods_name",placeholder:"请输入",width:"180px"},{type:"Input",label:"下单用户手机号",prop:"user_mobile",placeholder:"请输入",width:"180px"},{type:"Select",label:"状态",prop:"status",width:"180px",options:S,placeholder:"请选择状态"},{type:"DateRange",label:"创建时间",prop:"created_time",width:"280px"},{type:"DateRange",label:"核销时间",prop:"write_off_time",width:"280px"},{type:"Input",label:"核销码",prop:"write_off_code",placeholder:"请输入",width:"180px"},{type:"Input",label:"主订单号",prop:"parent_order_no",placeholder:"请输入",width:"180px"}]),O=t({merchant_type:"",merchant_name:"",goods_name:"",user_mobile:"",status:"all",created_time:[],write_off_time:[],write_off_code:""}),z=t([{label:"查 询",icon:"Search",auth:"admin/merchant/order/sub_order_list",handle:()=>G()},{label:"重置",auth:"admin/merchant/order/sub_order_list",handle:()=>Q()},{label:"排序",popover:!0}]),R=t([]),V=t({page:1,page_size:20,totalPages:0}),Y=t([{label:"ID",prop:"id",align:"center",type:"string",sortable:!1,minWidth:"80",show:!0},{label:"主订单编号",prop:"parent_order_no",align:"center",type:"string",sortable:!1,minWidth:"160",show:!0},{label:"子订单编号",prop:"order_no",align:"center",type:"string",sortable:!1,minWidth:"160",show:!0},{label:"商户类型",prop:"merchant_type_text",align:"center",type:"string",sortable:!1,minWidth:"120",show:!0},{label:"商户名称",prop:"merchant_name",align:"center",type:"string",sortable:!1,minWidth:"120",show:!0},{label:"商品名称",prop:"goods_name",align:"center",type:"string",imgWidth:"35px",sortable:!1,minWidth:"80",show:!0},{label:"订单金额（TN）",prop:"order_price",align:"center",type:"string",imgWidth:"35px",sortable:!1,minWidth:"80",show:!0},{label:"订单金额（円）",prop:"order_price",align:"center",type:"string",imgWidth:"35px",sortable:!1,minWidth:"80",show:!0},{label:"订单金额（CNY）",prop:"order_price_r",align:"center",type:"string",imgWidth:"35px",sortable:!1,minWidth:"80",show:!0},{label:"结算金额（TN）",prop:"settle_price",align:"center",type:"string",sortable:!1,minWidth:"120",show:!0},{label:"分佣总金额（TN）",prop:"fenyong_price",align:"center",type:"string",sortable:!1,minWidth:"120",show:!0},{label:"下单用户昵称",prop:"user_nick_name",align:"center",type:"string",sortable:!1,minWidth:"120",show:!0},{label:"下单账号",prop:"user_mobile",align:"center",type:"string",sortable:!1,minWidth:"120",show:!0},{label:"核销码",prop:"write_off_code",align:"center",type:"string",sortable:!1,minWidth:"120",show:!0},{label:"创建时间",prop:"created_at",align:"center",type:"string",sortable:!1,minWidth:"160",show:!0},{label:"核销时间",prop:"write_off_time",align:"center",type:"timestamp",sortable:!1,minWidth:"160",show:!0},{label:"状态",prop:"status_text",align:"center",type:"string",sortable:!1,minWidth:"110",show:!0},{label:"操作",minWidth:"110",type:"button",show:!0,fixed:"right",align:"center",btnList:[{labelTextFn:e=>A(e),typeFn:e=>U(e),hide:e=>$(e),auth:"admin/merchant/order/update_status",handle:(e,a)=>Z(a,"1")},{label:"取消订单",hide:e=>q(e),type:"danger",auth:"admin/merchant/order/plate_cancel_order",handle:(e,a)=>Z(a,"cancel")},{label:"联系用户",type:"success",auth:"admin/im/chat/user_info",handle:(e,a)=>B(a)},{label:"详情",type:"primary",auth:"admin/merchant/order/update_status",handle:(e,a)=>M(a)}]}]),A=e=>2===e.status?"确认订单":3===e.status?"核销":void 0,U=e=>3===e.status?"primary":2===e.status?"default":void 0,$=e=>2!==e.status&&3!==e.status,q=e=>2!==e.status&&3!==e.status,B=async e=>{const a=await l("/admin/im/chat/user_info",{user_id:e.user_id});a&&N.push({path:"/chat/conversation/message",query:{id:a.im_user_id,chatType:j.SINGLE,nickname:a.nickname,userType:"0",toAvatarUrl:a.avatar_url}})},G=()=>{V.value.page=1,X()},J=t(!1),K=r({}),M=e=>{F(K),Object.assign(K,e),J.value=!0},Q=()=>{F(O.value),V.value.page=1,V.value.page_size=20,O.value.status="all",X()};t(!1);const X=async()=>{var e;let a=[];(null==(e=O.value.write_off_time)?void 0:e.length)>0&&(a[0]=new Date(O.value.write_off_time[0]).getTime(),a[1]=new Date(O.value.write_off_time[1]).getTime());let t={...V.value,...O.value,write_off_time:a};const l=await s(E.value.getList,t);if(l&&(R.value=[],V.value.total=l.page.total||0,R.value.splice(0),l.list.length>0))for(let r=0;r<l.list.length;r++){let e=l.list[r];R.value.push(e)}};r({}),i.on("getCheckData",(e=>{(e=>{const a=[];e.list.forEach((e=>{a.push(e.label)})),Y.value.sort(((e,t)=>"操作"===e.label?1:a.indexOf(e.label)-a.indexOf(t.label))),Y.value=Y.value.map((a=>e.data.includes(a.label)||"操作"===a.label?{...a,show:!0}:{...a,show:!1}))})(e)})),n((()=>{X()}));const Z=(e,a)=>{let t={id:e.id},l="",r="";2===e.status&&"cancel"!==a?(t.status=3,l="确认",r="/admin/merchant/order/update_status"):3===e.status&&"cancel"!==a?(t.status=4,l="核销",r="/admin/merchant/order/update_status"):"cancel"===a&&(l="取消",r="/admin/merchant/order/plate_cancel_order"),o.alert(`是否${l}该订单？`,"提示",{confirmButtonText:"确定",callback:async e=>{if("confirm"===e){await s(r,t)&&(p.success(`${l}成功`),X())}}})},ee=t([{label:"ID",prop:"id"},{label:"主订单编号",prop:"parent_order_no"},{label:"子订单编号",prop:"order_no"},{label:"商户类型",prop:"merchant_type_text"},{label:"商户名称",prop:"merchant_name"},{label:"商品名称",prop:"goods_name"},{label:"订单金额（TN）",prop:"order_price"},{label:"订单金额（円）",prop:"order_price"},{label:"订单金额（CNY）",prop:"order_price_r"},{label:"结算金额",prop:"link"},{label:"分佣总金额",prop:"link"},{label:"下单用户昵称",prop:"user_nick_name"},{label:"下单账号",prop:"user_mobile"},{label:"核销码",prop:"write_off_code"},{label:"创建时间",prop:"created_at"},{label:"核销时间",prop:"write_off_time"},{label:"状态",prop:"status_text"}]);return(e,a)=>{const t=f,l=d("cusTable"),r=T,s=x,i=W;return c(),u("div",k,[h("div",D,[b(r,null,{default:m((()=>[b(t,{searchForm:L.value,searchData:O.value,searchHandle:z.value,tableCols:Y.value,onHandleEnterSearch:G,onHandleReset:Q},null,8,["searchForm","searchData","searchHandle","tableCols"]),b(l,{ref:"cusTable",height:"calc(100vh - 240px)","row-key":"id",isPagination:!0,isHandle:!0,tableCols:Y.value,tableData:R.value,tablePage:V.value,onHandleCurrentChange:X},null,8,["tableCols","tableData","tablePage"])])),_:1})]),b(i,{modelValue:J.value,"onUpdate:modelValue":a[1]||(a[1]=e=>J.value=e),title:"详情",width:"900"},{footer:m((()=>[h("div",H,[b(s,{onClick:a[0]||(a[0]=e=>J.value=!1)},{default:m((()=>a[2]||(a[2]=[_("关闭")]))),_:1})])])),default:m((()=>[h("div",C,[(c(!0),u(g,null,v(ee.value,(e=>(c(),u("p",{key:e.prop},[h("span",I,y(e.label)+"：",1),h("span",null,y(K[e.prop]),1)])))),128))])])),_:1},8,["modelValue"])])}}},[["__scopeId","data-v-7756bad6"]]);export{N as default};
