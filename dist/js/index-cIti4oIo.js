import{f as e,g as a,T as l,y as t,ai as i,H as n,S as o,j as d,r,o as s,c as u,a as c,d as v,w as p,e as m,t as h,L as g,i as b,aj as f,aw as _,M as y,N as w,D as x,aa as C,a3 as V,a4 as k,bQ as j,B as D,E as A}from"./index-BdR_P0jW.js";/* empty css                */import E from"./addForm-2b_tJkdK.js";import{E as H}from"./index-C5CR2e01.js";import"./dialogComp-DpPpTGA3.js";import"./index-DIDL6cCO.js";/* empty css                    */import"./index-TSZus3Mb.js";const O={class:"boxElMain"},T={class:"box boxFlex"},W={class:"dialog-footer"},L={class:"dialog-footer"},U={class:"dialog-footer"},F={__name:"index",setup(F){const R=e({getList:"/admin/merchant/com_config/list",save_submit:"/admin/merchant/com_config/edit_save",getDetail:"/admin/merchant/com_config/detail",deleteApi:"/admin/merchant/com_config/del",levelListApi:"/admin/merchant/com_level/index/lists",levelEditApi:"/admin/merchant/com_level/edit",levelDeleteApi:"/admin/merchant/com_level/delete/"}),B=e(["一级","二级","三级","四级","五级","六级","七级","八级","九级","十级"]),P=e(""),z=a({}),S=e([]),$=e({goods_id:""}),M=e([{label:"查 询",icon:"Search",handle:()=>N()},{label:"排序",popover:!0}]),q=e([{label:"新增",icon:"Plus",handle:()=>se()}]),G=e({page:1,page_size:20}),I=e([{label:"序号",prop:"id",align:"center",type:"string",sortable:!1,minWidth:"80",show:!0},{label:"佣金分佣总比例",prop:"com_total_rate",align:"center",type:"percentage",sortable:!1,minWidth:"120",show:!0},{label:"佣金渠道比例",prop:"com_channel_rate",align:"center",type:"percentage",sortable:!1,minWidth:"120",show:!0},{label:"佣金商户比例",prop:"com_bd_rate",align:"center",type:"percentage",sortable:!1,minWidth:"120",show:!0},{label:"积分分佣总比例",prop:"integral_total_rate",align:"center",type:"percentage",sortable:!1,minWidth:"120",show:!0},{label:"积分渠道比例",prop:"integral_channel_rate",align:"center",type:"percentage",sortable:!1,minWidth:"120",show:!0},{label:"积分商务比例",prop:"integral_bd_rate",align:"center",type:"percentage",sortable:!1,minWidth:"120",show:!0},{label:"操作",minWidth:"320",type:"button",show:!0,fixed:"right",align:"center",btnList:[{label:"编辑",type:"primary",auth:"['admin/version/detail']",handle:(e,a,l,t,i)=>X(e,a)},{label:"删除",type:"danger",auth:"['admin/version/detail']",handle:(e,a,l,t,i)=>Z(e,a)},{label:"等级设置",type:"dropdown",auth:"['admin/version/detail']",options:[{label:"佣金渠道等级"},{label:"佣金商务等级"},{label:"积分渠道等级"},{label:"积分商务等级"}],handle:(e,a)=>K(e,a)}]}]);l.on("getCheckData",(e=>{(e=>{const a=[];e.list.forEach((e=>{a.push(e.label)})),I.value.sort(((e,l)=>"操作"===e.label?1:a.indexOf(e.label)-a.indexOf(l.label))),I.value=I.value.map((a=>e.data.includes(a.label)||"操作"===a.label?{...a,show:!0}:{...a,show:!1}))})(e)}));const N=()=>{G.pageCurrent=1,ve()},Q=e=>{for(const a of Object.keys(e))delete e[a]},X=(e,a,l,t,i)=>{de.value="编辑商户",Q(z),J(a.id),P.value="edit"},J=async(e,a)=>{const l=await t(R.value.getDetail,{id:e});l&&(Object.assign(z,l),oe.value=!0)},K=(e,a)=>{"佣金渠道等级"===e.label?ae(a):"佣金商务等级"===e.label?le(a):"积分渠道等级"===e.label?te(a):"积分商务等级"===e.label&&ie(a)},Y=e(!1),Z=(e,a)=>{i.confirm("确定删除该方案吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消"}).then((()=>{ee(a.id)})).catch((()=>{}))},ee=async e=>{await t(R.value.deleteApi,{id:e})&&(ve(),n.success("删除成功")),Y.value=!1},ae=e=>{he.value="佣金渠道等级",_e(e,"1")},le=e=>{he.value="佣金商务等级",_e(e,"2")},te=e=>{he.value="积分渠道等级",_e(e,"3")},ie=e=>{he.value="积分商务等级",_e(e,"4")},ne=e(!1),oe=e(!1),de=e(""),re=e("1"),se=()=>{ne.value=!0},ue=()=>{oe.value=!0,ne.value=!1,P.value="add"},ce=e([]),ve=async()=>{const e=await t(R.value.getList,{...G.value,...$.value});if(e&&(ce.value=[],G.value=(null==e?void 0:e.page)||{},ce.value.splice(0),e.list.length>0))for(let a=0;a<e.list.length;a++){let l=e.list[a];ce.value.push(l)}};e(!1),o((()=>{ve()}));const pe=()=>{Q($.value),G.value.page=1,G.value.page_size=20,ve()},me=e(!1),he=e(""),ge=e([]),be=e(""),fe=e(""),_e=(e,a)=>{Q(z),Object.assign(z,e),be.value=e.id,fe.value=a,xe()},ye=e(!1),we=e(""),xe=async()=>{let e={type:fe.value,config_id:be.value,page:1,page_size:100},a=await d(R.value.levelListApi,e);a&&(ge.value=a.list),me.value=!0},Ce=a({}),Ve=()=>{var e;Q(Ce),null==(e=ke.value)||e.clearValidate(),ye.value=!0,we.value="新增等级"},ke=e(null),je=async()=>{ke.value.validate((async e=>{if(!e)return n.error("校验失败，请根据页面提示填写"),!1;{let e={...Ce,config_id:be.value,type:fe.value,rate:Ce.rate};await t(R.value.levelEditApi,e)&&(ye.value=!1,xe(),n.success((Ce.id?"编辑":"新增")+"成功"))}}))},De=e=>{"closeDialog"===e?oe.value=!1:"closeDialogAndRefresh"===e&&(oe.value=!1,ve())};return(e,a)=>{const l=_,t=r("cusTable"),n=H,o=y,d=w,F=x,X=C,J=V,K=k,Y=j,Z=D,ae=A;return s(),u("div",null,[c("div",O,[c("div",T,[v(n,null,{default:p((()=>[v(l,{searchForm:S.value,searchData:$.value,searchHandleRight:q.value,searchHandle:M.value,tableCols:I.value,onHandleEnterSearch:N,onHandleReset:pe},null,8,["searchForm","searchData","searchHandleRight","searchHandle","tableCols"]),v(t,{ref:"cusTable",height:"calc(100vh - 240px)","row-key":"id",isPagination:!0,isHandle:!0,tableCols:I.value,tableData:ce.value,tablePage:G.value,onHandleCurrentChange:ve},null,8,["tableCols","tableData","tablePage"])])),_:1})])]),v(E,{modelValue:oe.value,"onUpdate:modelValue":a[0]||(a[0]=e=>oe.value=e),data:z,addOrEdit:P.value,addType:re.value,onRefreshList:De},null,8,["modelValue","data","addOrEdit","addType"]),v(X,{modelValue:ne.value,"onUpdate:modelValue":a[3]||(a[3]=e=>ne.value=e),title:"请选择配置方式",width:"500"},{footer:p((()=>[c("div",W,[v(F,{onClick:a[2]||(a[2]=e=>ne.value=!1)},{default:p((()=>a[11]||(a[11]=[m("取消")]))),_:1}),v(F,{type:"primary",onClick:ue},{default:p((()=>a[12]||(a[12]=[m(" 确定 ")]))),_:1})])])),default:p((()=>[v(d,{modelValue:re.value,"onUpdate:modelValue":a[1]||(a[1]=e=>re.value=e)},{default:p((()=>[v(o,{value:"1"},{default:p((()=>a[9]||(a[9]=[m(" 全类目统一配置 ")]))),_:1}),v(o,{value:"2"},{default:p((()=>a[10]||(a[10]=[m(" 商品单独配置 ")]))),_:1})])),_:1},8,["modelValue"])])),_:1},8,["modelValue"]),v(X,{modelValue:me.value,"onUpdate:modelValue":a[5]||(a[5]=e=>me.value=e),title:he.value,width:"700"},{footer:p((()=>[c("div",L,[v(F,{onClick:a[4]||(a[4]=e=>me.value=!1)},{default:p((()=>a[16]||(a[16]=[m("取消")]))),_:1}),v(F,{type:"primary",onClick:ee},{default:p((()=>a[17]||(a[17]=[m(" 确定 ")]))),_:1})])])),default:p((()=>[c("div",null,[v(K,{data:ge.value},{default:p((()=>[v(J,{label:"ID",prop:"id"}),v(J,{label:"等级",prop:"grade"},{default:p((({$index:e})=>[m(h(B.value[e]),1)])),_:1}),v(J,{label:"比例",prop:"rate"},{default:p((({row:e})=>[m(h(e.rate)+"% ",1)])),_:1}),v(J,{label:"操作"},{default:p((({row:e,$index:l})=>[v(F,{link:"",type:"primary",onClick:a=>(e=>{var a;Q(Ce),Object.assign(Ce,e),ye.value=!0,we.value="编辑等级",null==(a=ke.value)||a.clearValidate()})(e)},{default:p((()=>a[13]||(a[13]=[m("编辑")]))),_:2},1032,["onClick"]),l===ge.value.length-1?(s(),g(F,{key:0,link:"",type:"primary",onClick:a=>(e=>{i.alert("确定删除此等级吗？","提示",{confirmButtonText:"确定",callback:async a=>{"confirm"===a?await f(R.value.levelDeleteApi+`${e.id}`)&&xe():xe()}})})(e)},{default:p((()=>a[14]||(a[14]=[m("删除")]))),_:2},1032,["onClick"])):b("",!0)])),_:1})])),_:1},8,["data"]),v(F,{type:"primary",plain:"",style:{width:"100%","margin-top":"10px"},onClick:Ve},{default:p((()=>a[15]||(a[15]=[m("新增")]))),_:1})])])),_:1},8,["modelValue","title"]),v(X,{modelValue:ye.value,"onUpdate:modelValue":a[8]||(a[8]=e=>ye.value=e),title:we.value,width:"400",style:{"margin-top":"20vh"}},{footer:p((()=>[c("div",U,[v(F,{onClick:a[7]||(a[7]=e=>ye.value=!1)},{default:p((()=>a[18]||(a[18]=[m("取消")]))),_:1}),v(F,{type:"primary",onClick:je},{default:p((()=>a[19]||(a[19]=[m(" 确定 ")]))),_:1})])])),default:p((()=>[c("div",null,[v(ae,{model:Ce,ref_key:"addGradeForm",ref:ke},{default:p((()=>[v(Z,{label:"比例",prop:"rate",rules:[{required:!0,message:"请输入比例",trigger:"blur"}]},{default:p((()=>[v(Y,{modelValue:Ce.rate,"onUpdate:modelValue":a[6]||(a[6]=e=>Ce.rate=e),precision:2,step:.01,max:100},null,8,["modelValue"])])),_:1})])),_:1},8,["model"])])])),_:1},8,["modelValue","title"])])}}};export{F as default};
