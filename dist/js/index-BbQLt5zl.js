import{f as e,ai as a,y as t,H as l,g as n,T as i,S as r,r as s,o,c as p,a as d,d as c,w as h,av as b,aw as u,j as m}from"./index-BdR_P0jW.js";/* empty css                */import g from"./detailForm-yh091l4C.js";import{E as y}from"./index-C5CR2e01.js";const _={class:"boxElMain"},w={class:"box boxFlex"},v={__name:"index",setup(v){const W=e({admin_user_id:"",bill_date:[]}),f=e([]);(async()=>{(async()=>{var e;const a=await m("/admin/companies/index/lists",{page_size:9999,page:1});f.value=(null==(e=null==a?void 0:a.lists)?void 0:e.list.map((e=>({label:e.real_name,value:e.admin_user_id}))))||[]})()})();const x=e([{type:"DateTimeRange",label:"出账日期",prop:"bill_date",placeholder:"请选择",width:"280px"},{type:"Select",label:"汽车公司",options:f,prop:"admin_user_id",width:"200px"}]),S=e({order_type:"all",use_time:""}),C=e([{label:"查 询",icon:"Search",handle:()=>E()}]),H=e([]),R=e([{label:"公司",prop:"admin_user_name",align:"center",type:"string",sortable:!1,minWidth:"200",show:!0},{label:"账期",prop:"bill_date",align:"center",type:"string",sortable:!1,minWidth:"100",show:!0},{label:"订单数",prop:"order_number",align:"center",type:"string",sortable:!1,minWidth:"100",show:!0},{label:"含税总价格（客户消费总额）",type:"Secondary",align:"center",type:"string",sortable:!1,minWidth:"160",show:!0,propSec:[{label:"日币(円)/WACN(TN)",prop:"total_price",align:"center",type:"string",sortable:!1,minWidth:"120",show:!0},{label:"人民币(元)",prop:"total_price_r",align:"center",type:"string",sortable:!1,minWidth:"120",show:!0}]},{label:"国内3%增值税",prop:"zengzhishui",align:"center",type:"string",sortable:!1,minWidth:"120",show:!0},{label:"平台留存占总价比例",prop:"plate_save_rate",align:"center",type:"percentage",sortable:!1,minWidth:"100",show:!0},{label:"平台最终留存额",type:"Secondary",align:"center",type:"string",sortable:!1,minWidth:"120",show:!0,propSec:[{label:"日币(円)",prop:"plate_price",align:"center",type:"string",sortable:!1,minWidth:"120",show:!0}]},{label:"汽车公司结算额占总价比例",prop:"company_rate",align:"center",type:"percentage",sortable:!1,minWidth:"120",show:!0},{label:"日本汽车公司结算金额（内含消费税）",type:"Secondary",align:"center",type:"string",sortable:!1,minWidth:"120",show:!0,propSec:[{label:"日币(円)/WACN(TN)",prop:"company_price",align:"center",type:"string",sortable:!1,minWidth:"120",show:!0},{label:"人民币(元)",prop:"company_price_r",align:"center",type:"string",sortable:!1,minWidth:"120",show:!0}]},{label:"订单价格TN",type:"Secondary",align:"center",type:"string",sortable:!1,minWidth:"120",show:!0,propSec:[{label:"日币(円)",prop:"order_price",align:"center",type:"string",sortable:!1,minWidth:"120",show:!0}]},{label:"平台的利润额（扣除增值税）",type:"Secondary",align:"center",type:"string",sortable:!1,minWidth:"120",show:!0,propSec:[{label:"日币(円)",prop:"plate_profit",align:"center",type:"string",sortable:!1,minWidth:"120",show:!0}]},{label:"平台最终利润率",prop:"plate_profit_rate",align:"center",type:"percentage",sortable:!1,minWidth:"120",show:!0},{label:"状态",prop:"status_text",align:"center",type:"string",sortable:!1,minWidth:"100",show:!0},{label:"备注",prop:"remark",align:"center",type:"string",sortable:!1,minWidth:"200",show:!0},{label:"打款时间",prop:"audit_date",align:"center",type:"string",sortable:!1,minWidth:"200",show:!0},{label:"领收书",minWidth:"130",type:"button",show:!0,fixed:"right",align:"center",btnList:[{hide:e=>j(e),label:"查看",type:"text",auth:"['admin/version/detail']",handle:(e,a)=>L(a)},{hide:e=>j(e),label:"下载",type:"text",auth:"['admin/version/detail']",handle:(e,a)=>z(a)}]},{label:"操作",minWidth:"110",type:"button",show:!0,fixed:"right",align:"center",btnList:[{label:"明细",type:"primary",auth:"['admin/version/detail']",handle:(e,a,t,l,n)=>U(a)},{hide:e=>O(e),label:"结算",type:"primary",auth:"['admin/company_withdraw/audit']",handle:(e,a,t,l,n)=>D(a)}]}]),j=e=>!e.file_url,O=e=>1!==e.status,T=(e,a=!0)=>{const t=new XMLHttpRequest;t.open("get",e),t.responseType="blob",t.send(),t.onload=function(){if(200===this.status||304===this.status){if("msSaveOrOpenBlob"in navigator)return void navigator.msSaveOrOpenBlob(this.response,name);const t=URL.createObjectURL(this.response);if(a){const a=document.createElement("a");a.style.display="none",a.href=t,a.download=e,document.body.appendChild(a),a.click(),document.body.removeChild(a),URL.revokeObjectURL(t)}else window.open(t,e)}}},L=e=>{T(e.file_url,!1)},z=e=>{T(e.file_url)},D=async e=>{a.confirm("是否结算该公司的对账单？").then((async()=>{await t("/admin/company_withdraw/audit",{id:e.id,status:"2"})&&(l({type:"success",message:"操作成功"}),A())})).catch((()=>{}))},N=e(!1),U=async e=>{const a=await t("/admin/company_withdraw/withdraw_detail",{id:e.id});a&&(N.value=!0,B.value=a)},k=async()=>{A()},E=()=>{V.value.pageCurrent=1,A()},F=()=>{b.clearObj(S),V.value.pageCurrent=1,A()},P=e([]),V=e({page:1,page_size:20,total:0}),A=async()=>{const e=await t("/admin/company_withdraw/withdraw_list",{page:V.value.page,page_size:V.value.page_size,bill_date:W.value.bill_date,admin_user_id:W.value.admin_user_id,status:"all"});e&&(P.value=(null==e?void 0:e.list)||[])};n({});const B=e([]),M=e([]);return i.on("sortChange",(({prop:e,order:a})=>{let t="";t=-1!==e.indexOf("_text")?e.replace("_text",""):e,M.value=M.value.filter((e=>!e[t])),"descending"===a?M.value.push({[t]:"desc"}):"ascending"===a?M.value.push({[t]:"asc"}):M.value=M.value.filter((e=>!e[t])),A()})),r((()=>{A()})),(e,a)=>{const t=u,l=s("cusTable"),n=y;return o(),p("div",_,[d("div",w,[c(n,null,{default:h((()=>[c(t,{searchForm:x.value,searchData:S.value,searchHandleRight:H.value,searchHandle:C.value,tableCols:R.value,onHandleEnterSearch:E,onHandleReset:F},null,8,["searchForm","searchData","searchHandleRight","searchHandle","tableCols"]),c(l,{ref:"cusTable",height:"calc(100vh - 240px)","row-key":"test_admin_user_id",isPagination:!0,isHandle:!0,tableCols:R.value,tableData:P.value,tablePage:V.value,SecondaryHead:"",onHandleCurrentChange:A},null,8,["tableCols","tableData","tablePage"])])),_:1})]),c(g,{modelValue:N.value,"onUpdate:modelValue":a[0]||(a[0]=e=>N.value=e),data:B.value,onSubmit:k},null,8,["modelValue","data"])])}}};export{v as default};
