import{f as e,ai as a,j as l,H as t,y as n,g as r,T as i,S as s,r as o,o as d,c,a as u,d as p,w as h,e as m,t as g,aw as v,D as b,aa as _}from"./index-BdR_P0jW.js";/* empty css                */import f from"./refundTypeForm-GHQOlbC9.js";import{E as y}from"./index-C5CR2e01.js";import"./dialogComp-DpPpTGA3.js";import"./index-DIDL6cCO.js";/* empty css                    */import"./index-TSZus3Mb.js";const w={class:"boxElMain"},x={class:"box boxFlex"},j={class:"dialog-footer"},D={__name:"index",setup(D){const k=e({getList:"/admin/merchant/order_refund_config/page_list",getDetail:"/admin/merchant/order_refund_config/detail",delete:"/admin/merchant/order_refund_config/deletes"}),C=e([]);(async()=>{const e=await n("/admin/merchant/type/tree_list");C.value=(null==e?void 0:e.map((e=>{var a;return(null==(a=e.children)?void 0:a.length)>0&&(e.children=e.children.map((e=>({value:e.key,label:e.name})))),{value:e.key,label:e.name,children:e.children}})))||[]})();const H=e([{type:"cascader",label:"类型名称",prop:"merchant_type",width:"180px",options:C,placeholder:"请选择状态"}]),O=e({name:"",status:"all",parent_key:"all"}),W=e([{label:"查 询",icon:"Search",auth:"admin/merchant/order_refund_config/page_list",handle:()=>T()},{label:"重置",auth:"admin/merchant/order_refund_config/page_list",handle:()=>I()},{label:"排序",popover:!0}]),E=e([{label:"新增",icon:"Plus",handle:()=>U(),auth:"admin/merchant/order_refund_config/edit_save"}]),S=e([]),V=e({page:1,page_size:20,totalPages:0}),P=e([{label:"ID",prop:"id",align:"center",type:"string",sortable:!1,minWidth:"80",show:!0},{label:"类型ID",prop:"merchant_type",align:"center",type:"string",sortable:!1,minWidth:"80",show:!0},{label:"类型名称",prop:"merchant_type_text",align:"center",type:"string",sortable:!1,minWidth:"120",show:!0},{label:"规则名称",prop:"name",align:"center",type:"string",sortable:!1,minWidth:"120",show:!0},{label:"退款比例",prop:"refund_rate",align:"center",type:"percentage",sortable:!1,minWidth:"120",show:!0},{label:"退款手续费",prop:"handle_rate",align:"center",type:"percentage",sortable:!1,minWidth:"120",show:!0},{label:"退款规则描述",prop:"desc",align:"center",type:"string",sortable:!1,minWidth:"160",show:!0},{label:"创建时间",prop:"created_at",align:"center",type:"string",sortable:!1,minWidth:"160",show:!0},{label:"操作",minWidth:"160",type:"button",show:!0,fixed:"right",align:"center",btnList:[{label:"编辑",type:"primary",auth:"admin/merchant/order_refund_config/edit_save",handle:(e,a,l,t,n)=>L(e,a)},{hide:e=>R(e),label:"删除",type:"danger",auth:"admin/merchant/order_refund_config/deletes",handle:(e,a,l,t,n)=>z(e,a)}]}]),R=e=>"common"===e.merchant_type,T=()=>{V.value.page=1,A()},F=e=>{for(const a of Object.keys(e))delete e[a]},L=(e,a,l,t,r)=>{(async e=>{const a=await n(k.value.getDetail,{id:e});a&&(F(B),N.value=!0,J.value="edit",Object.assign(B,a))})(a.id)},z=(e,n)=>{a.alert("确认删除此退款配置吗？","提示",{confirmButtonText:"OK",callback:e=>{if("confirm"===e){const e=n.id.toString();l(k.value.delete,{id:e}).then((e=>{e&&(t.success("删除成功"),A())}))}}})},I=()=>{F(O.value),V.value.page=1,V.value.page_size=20,O.value.status="all",O.value.parent_key="all",A()},J=e(""),N=e(!1),U=()=>{F(B),N.value=!0,J.value="add"},A=async()=>{let e=JSON.parse(JSON.stringify(O.value));"object"==typeof(null==e?void 0:e.merchant_type)&&1===(null==e?void 0:e.merchant_type.length)?e.merchant_type=null==e?void 0:e.merchant_type[0]:"object"==typeof(null==e?void 0:e.merchant_type)&&(null==e?void 0:e.merchant_type.length)>1&&(e.merchant_type=null==e?void 0:e.merchant_type[1]);const a=await n(k.value.getList,{...V.value,...e});if(a&&(S.value=[],V.value.total=a.page.total||0,S.value.splice(0),a.list.length>0))for(let l=0;l<a.list.length;l++){let e=a.list[l];S.value.push(e)}},B=r({});i.on("getCheckData",(e=>{(e=>{const a=[];e.list.forEach((e=>{a.push(e.label)})),P.value.sort(((e,l)=>"操作"===e.label?1:a.indexOf(e.label)-a.indexOf(l.label))),P.value=P.value.map((a=>e.data.includes(a.label)||"操作"===a.label?{...a,show:!0}:{...a,show:!1}))})(e)})),s((()=>{A()}));const K=e(!1),M=async()=>{let e={id:B.id};await n("/admin/merchant/type/update_status",e)&&(A(),K.value=!1)},q=e=>{"closeDialog"===e?(F(B),N.value=!1):"closeDialogAndRefresh"===e&&(N.value=!1,A())};return(e,a)=>{const l=v,t=o("cusTable"),n=y,r=b,i=_;return d(),c("div",w,[u("div",x,[p(n,null,{default:h((()=>[p(l,{searchForm:H.value,searchData:O.value,searchHandleRight:E.value,searchHandle:W.value,tableCols:P.value,onHandleEnterSearch:T,onHandleReset:I},null,8,["searchForm","searchData","searchHandleRight","searchHandle","tableCols"]),p(t,{ref:"cusTable",height:"calc(100vh - 240px)","row-key":"id",isPagination:!0,isHandle:!0,tableCols:P.value,tableData:S.value,tablePage:V.value,onHandleCurrentChange:A},null,8,["tableCols","tableData","tablePage"])])),_:1})]),p(f,{modelValue:N.value,"onUpdate:modelValue":a[0]||(a[0]=e=>N.value=e),data:B,addOrEdit:J.value,onRefreshList:q},null,8,["modelValue","data","addOrEdit"]),p(i,{modelValue:K.value,"onUpdate:modelValue":a[2]||(a[2]=e=>K.value=e),title:"提示",width:"500"},{footer:h((()=>[u("div",j,[p(r,{onClick:a[1]||(a[1]=e=>K.value=!1)},{default:h((()=>a[3]||(a[3]=[m("取消")]))),_:1}),p(r,{type:"primary",onClick:M},{default:h((()=>a[4]||(a[4]=[m(" 确定 ")]))),_:1})])])),default:h((()=>[u("span",null,"确定要"+g(1===B.status?"禁用":"启用")+"该类型吗",1)])),_:1},8,["modelValue"])])}}};export{D as default};
