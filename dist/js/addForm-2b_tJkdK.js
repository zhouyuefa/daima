import{_ as e,R as a,g as t,h as l,y as r,f as i,o as s,c as n,d as o,w as p,a as u,e as d,J as m,K as c,L as g,H as h,aw as b,a3 as y,a4 as v,D as _,aa as f}from"./index-BdR_P0jW.js";import{d as w}from"./dialogComp-DpPpTGA3.js";import"./index-DIDL6cCO.js";/* empty css                    */import"./index-TSZus3Mb.js";const x={class:"dialog-footer"},j=e({__name:"addForm",props:{modelValue:{type:Boolean,default:!1},data:{type:Object,default:()=>({id:"000000000"})},addOrEdit:{type:String,default:""},addType:{type:String,default:"1"}},emits:["submit","refreshList"],setup(e,{emit:j}){const N=j,W=e,k=a((()=>W.modelValue)),S=a((()=>("edit"===W.addOrEdit?"编辑":"新增")+"佣金配置")),O=a((()=>W.data.id)),V=t({}),D=e=>{for(const a of Object.keys(e))delete e[a]};l((()=>W.modelValue),(async e=>{e&&!O.value&&D(V)})),l(O,(async e=>{if(e??0){let e=JSON.parse(JSON.stringify(W.data));e.file_id={file_id:e.file_id,file_url:e.file_url},Object.assign(V,e),J()}else D(V)}));const T=t({merchant_type:[{required:!0,message:"请选择",trigger:["blur","change"]}],key:[{required:!0,message:"请输入",trigger:"blur"}],name:[{required:!0,message:"请输入",trigger:"blur"}],sort:[{required:!0,message:"请输入",trigger:"blur"}],file_id:[{required:!0,message:"请上传",trigger:"blur"}],link:[{required:!0,message:"请输入",trigger:"blur"}],is_top:[{required:!0,message:"请选择",trigger:["blur","change"]}]}),q=t([]),J=async()=>{const{list:e}=await r("/admin/merchant/goods/list",{status:"all",page:1,page_size:999999});e&&(q.splice(0),e.map((e=>{q.push({value:e.id,label:e.goods_name})})))};J();const C=i([]);(async()=>{var e;const a=await r("/admin/merchant/type/list",{status:"all",page:1,page_size:999999});C.value=(null==(e=a.list)?void 0:e.map((e=>({value:e.id,label:e.name}))))||[]})();const L=async e=>{if(!e)return void N("refreshList","closeDialog");let a=JSON.parse(JSON.stringify(e));"object"==typeof(null==e?void 0:e.merchant_type)&&1===(null==e?void 0:e.merchant_type.length)?a.merchant_type=null==e?void 0:e.merchant_type[0]:"string"==typeof(null==e?void 0:e.merchant_type)?a.merchant_type=null==e?void 0:e.merchant_type:"object"==typeof(null==e?void 0:e.merchant_type)&&(a.merchant_type=null==e?void 0:e.merchant_type[1]),a.goods_id=U.value.id||void 0;await r("/admin/merchant/com_config/edit_save",a)&&(h.success("保存成功"),N("refreshList","closeDialogAndRefresh"))},H=i([]),z=i(!1),R=i(),E=i(),F=e=>{R.value=e},I=i(),U=i({}),A=()=>{U.value=JSON.parse(JSON.stringify(R.value)),z.value=!1},B=i([{label:"商户类型:",type:"cascader",msg:"merchant_type",hide:()=>"2"!==W.addType,options:C,change:e=>G(e)},{selected:!0,hide:()=>"1"!==W.addType,label:"商品选择:",buttonText:"点击选择商品",type:"button",linkType:"primary",handle:()=>($(),void(z.value=!0))},{tip:"佣金规则配置",type:"tip"},{label:"佣金分佣总比例(%):",type:"inputNumber",precision:2,step:.01,max:100,msg:"com_total_rate",span:24},{label:"佣金渠道比例，计算分佣总金额后，渠道占比(%):",type:"inputNumber",precision:2,step:.01,max:100,msg:"com_channel_rate",span:12},{label:"佣金商务比例(%)，计算分佣总金额后，商务占比:",type:"inputNumber",precision:2,step:.01,max:100,msg:"com_bd_rate",span:12},{tip:"积分规则配置",type:"tip"},{label:"积分分佣总比例(%):",type:"inputNumber",precision:2,step:.01,max:100,msg:"integral_total_rate",span:24},{label:"积分渠道比例(%)，计算分佣总积分后，渠道占比:",type:"inputNumber",precision:2,step:.01,max:100,msg:"integral_channel_rate",span:12},{label:"积分商务比例(%)，计算分佣总积分后，商务占比:",type:"inputNumber",precision:2,step:.01,max:100,width:"180px",msg:"integral_bd_rate",span:12}]),K=i(""),G=e=>{"object"==typeof e&&1===e.length?K.value=e[0]:"object"==typeof e&&e.length>1&&(K.value=e[1])},M=i([{label:"全部",value:"all"},{label:"草稿",value:"0"},{label:"审核中",value:"1"},{label:"已上架",value:"2"},{label:"已下架",value:"3"},{label:"已通过",value:"4"},{label:"已驳回",value:"5"}]),P=i([{type:"Input",label:"商品名称",prop:"name",placeholder:"请输入",width:"180px"},{type:"Select",label:"状态",prop:"status",width:"180px",options:M,placeholder:"请选择状态"}]),Q=i({status:"all",keyword:""}),X=i([{label:"查 询",icon:"Search",handle:()=>ee()},{label:"重置",handle:()=>ae()}]),Y=i({page:1,page_size:200}),Z=i([{label:"ID",prop:"id",align:"center",type:"string",sortable:!1,minWidth:"80",show:!0},{label:"商户类型",prop:"merchant.name",align:"center",sortable:!1,minWidth:"150",show:!0},{label:"商品名称",prop:"goods_name",align:"center",type:"string",imgWidth:"35px",sortable:!1,minWidth:"120",show:!0},{label:"副标题",prop:"subtitle",align:"center",type:"string",sortable:!1,minWidth:"120",show:!0},{label:"上架价格TN",prop:"sale_price",align:"center",type:"string",sortable:!1,minWidth:"120",show:!0},{label:"商户报价TN",prop:"cost_price",align:"center",type:"string",sortable:!1,minWidth:"120",show:!0},{label:"排序",prop:"sort",align:"center",type:"string",sortable:!1,minWidth:"120",show:!0},{label:"推荐排序",prop:"tuijian_sort",align:"center",type:"string",sortable:!1,minWidth:"120",show:!0},{label:"精选排序",prop:"jingxuan_sort",align:"center",type:"string",sortable:!1,minWidth:"120",show:!0},{label:"创建时间",prop:"created_at",align:"center",type:"string",sortable:!1,minWidth:"160",show:!0},{label:"状态",prop:"status_text",align:"center",type:"string",sortable:!1,minWidth:"110",show:!0}]),$=async()=>{let e={merchant_type:K.value,...Y.value,...Q.value};const a=await r("/admin/merchant/goods/list",e);if(a&&(H.value=[],Y.value=(null==a?void 0:a.page)||{},H.value.splice(0),a.list.length>0))for(let t=0;t<a.list.length;t++){let e=a.list[t];H.value.push(e)}},ee=()=>{Y.pageCurrent=1,$()},ae=()=>{D(Q.value),Q.value.status="all",Y.value.page=1,Y.value.page_size=1,$()};return(e,a)=>{const t=b,l=y,r=v,i=_,h=f;return s(),n(m,null,[o(w,{modelValue:k.value,"onUpdate:modelValue":a[0]||(a[0]=e=>k.value=e),formList:B.value,formData:V,rules:T,title:S.value,confirmValue:U.value,"label-position":"top",width:"950px",onSubmit:L},null,8,["modelValue","formList","formData","rules","title","confirmValue"]),o(h,{modelValue:z.value,"onUpdate:modelValue":a[2]||(a[2]=e=>z.value=e),width:"80vw"},{footer:p((()=>[u("div",x,[o(i,{onClick:a[1]||(a[1]=e=>z.value=!1)},{default:p((()=>a[3]||(a[3]=[d("取消")]))),_:1}),o(i,{type:"primary",onClick:A},{default:p((()=>a[4]||(a[4]=[d(" 确定 ")]))),_:1})])])),default:p((()=>[u("div",null,[o(t,{searchForm:P.value,searchData:Q.value,searchHandle:X.value,onHandleEnterSearch:ee,onHandleReset:ae},null,8,["searchForm","searchData","searchHandle"]),o(r,{ref_key:"singleTableRef",ref:I,data:H.value,"current-row-key":E.value,"row-key":"id","highlight-current-row":"",onCurrentChange:F},{default:p((()=>[(s(!0),n(m,null,c(Z.value,(e=>(s(),g(l,{"min-width":e.minWidth,label:e.label,prop:e.prop,key:e.prop},null,8,["min-width","label","prop"])))),128))])),_:1},8,["data","current-row-key"])])])),_:1},8,["modelValue"])],64)}}},[["__scopeId","data-v-a96e0f5d"]]);export{j as default};
