import{_ as e,R as a,g as t,h as l,f as r,y as i,r as n,o as s,c as o,d as p,w as d,a as u,e as c,J as m,H as g,aw as h,D as b,aa as _}from"./index-BdR_P0jW.js";import{d as y}from"./dialogComp-DpPpTGA3.js";import"./index-DIDL6cCO.js";/* empty css                    */import"./index-TSZus3Mb.js";const v={class:"dialog-footer"},f=e({__name:"addForm",props:{modelValue:{type:Boolean,default:!1},data:{type:Object,default:()=>({id:"000000000"})},addOrEdit:{type:String,default:""},addType:{type:String,default:""}},emits:["submit","refreshList"],setup(e,{emit:f}){const w=f,x=e,j=a((()=>x.modelValue)),N=a((()=>("edit"===x.addOrEdit?"编辑":"新增")+"佣金配置")),O=a((()=>x.data.merchant_type)),S=a((()=>x.data.goods_id)),W=t({}),T=e=>{for(const a of Object.keys(e))delete e[a]};l((()=>x.modelValue),(async e=>{!e||O.value||S.value||T(W)})),l(O,(async e=>{if("1"===x.addType){if(e??0){let e=JSON.parse(JSON.stringify(x.data));Object.assign(W,e)}else T(W)}})),l(S,(async e=>{if("2"===x.addType){if(e??0){let e=JSON.parse(JSON.stringify(x.data));Object.assign(W,e),C.value.map((e=>{e.id==W.goods_id&&(E.value=e)}))}else T(W)}}));const V=r([]);(async()=>{var e;const a=await i("/admin/merchant/type/list",{status:"all",page:1,page_size:999999});V.value=(null==(e=a.list)?void 0:e.map((e=>({value:e.key,label:e.name}))))||[]})();const D=t({merchant_type:[{required:!0,message:"请选择",trigger:["blur","change"]}],goods_id:[{required:!0,message:"请选择",trigger:["blur","change"]}],com_total_rate:[{required:!0,message:"请输入",trigger:"blur"}],com_channel_rate:[{required:!0,message:"请输入",trigger:"blur"}],com_bd_rate:[{required:!0,message:"请输入",trigger:"blur"}],integral_total_rate:[{required:!0,message:"请输入",trigger:"blur"}],integral_channel_rate:[{required:!0,message:"请输入",trigger:"blur"}],integral_bd_rate:[{required:!0,message:"请输入",trigger:"blur"}]}),J=r([{label:"商户类型:",type:"cascader",msg:"merchant_type",hide:()=>P(),options:V,disabled:()=>"edit"==x.addOrEdit,change:e=>I(e)},{selected:!0,hide:()=>z(),label:"商品选择:",buttonText:"点击选择商品",type:"button",linkType:"primary",disabled:()=>"edit"==x.addOrEdit,handle:()=>H()},{tip:"佣金规则配置",type:"tip"},{label:"商品佣金总比例（%） ： 商品分佣总佣金等于订单金额乘以该比例：",type:"inputNumber",precision:2,step:.01,max:100,msg:"com_total_rate",span:24},{label:"佣金渠道比例，计算分佣总金额后，渠道占比(%):",type:"inputNumber",precision:2,step:.01,max:100,msg:"com_channel_rate",span:12},{label:"佣金商务比例(%)，计算分佣总金额后，商务占比:",type:"inputNumber",precision:2,step:.01,max:100,msg:"com_bd_rate",span:12},{tip:"积分规则配置",type:"tip"},{label:"商品积分总比例（%）  ： 商品分佣总积分等于订单金额乘以该比例：",type:"inputNumber",precision:2,step:.01,max:100,msg:"integral_total_rate",span:24},{label:"积分渠道比例(%)，计算分佣总积分后，渠道占比:",type:"inputNumber",precision:2,step:.01,max:100,msg:"integral_channel_rate",span:12},{label:"积分商务比例(%)，计算分佣总积分后，商务占比:",type:"inputNumber",precision:2,step:.01,max:100,width:"180px",msg:"integral_bd_rate",span:12}]),q=async e=>{var a;if(!e)return w("refreshList","closeDialog"),T(W),void(E.value={});if(e.com_channel_rate+e.com_bd_rate>100)return void g.error("佣金渠道占比+商务占比不能大于100%");if(e.integral_channel_rate+e.integral_bd_rate>100)return void g.error("积分渠道占比+商务占比不能大于100%");let t=JSON.parse(JSON.stringify(e));e.merchant_type&&("object"==typeof(null==e?void 0:e.merchant_type)&&1===(null==(a=null==e?void 0:e.merchant_type)?void 0:a.length)?t.merchant_type=null==e?void 0:e.merchant_type[0]:"string"==typeof(null==e?void 0:e.merchant_type)?t.merchant_type=null==e?void 0:e.merchant_type:"object"==typeof(null==e?void 0:e.merchant_type)&&(t.merchant_type=null==e?void 0:e.merchant_type[1])),t.goods_id=E.value.id||void 0;await i("/admin/merchant/com_config/edit_save",t)&&(g.success("保存成功"),E.value={},w("refreshList","closeDialogAndRefresh"))},C=r([]),k=r(!1),H=()=>{M(),k.value=!0},L=r();r(),r();const E=r({}),P=()=>"2"!==x.addType&&("common"!==x.data.merchant_type&&"common_car"!==x.data.merchant_type),z=()=>"1"!==x.addType&&("common"!==x.data.merchant_type&&"common_car"!==x.data.merchant_type),F=r(""),I=e=>{"object"==typeof e&&1===e.length?F.value=e[0]:"object"==typeof e&&e.length>1&&(F.value=e[1])},R=r([{label:"全部",value:"all"},{label:"草稿",value:"0"},{label:"审核中",value:"1"},{label:"已上架",value:"2"},{label:"已下架",value:"3"},{label:"已通过",value:"4"},{label:"已驳回",value:"5"}]),U=r([{type:"Input",label:"商品名称",prop:"name",placeholder:"请输入",width:"180px"},{type:"Select",label:"状态",prop:"status",width:"180px",options:R,placeholder:"请选择状态"}]),A=r({status:"all",keyword:""}),B=r([{label:"查 询",icon:"Search",handle:()=>X()},{label:"重置",handle:()=>Y()}]),G=r({page:1,page_size:20}),K=r([{label:"ID",prop:"id",align:"center",type:"string",sortable:!1,minWidth:"80",show:!0},{label:"商户类型",prop:"merchant",subProp:"name",type:"object",align:"center",sortable:!1,minWidth:"150",show:!0},{label:"商品名称",prop:"goods_name",align:"center",type:"string",imgWidth:"35px",sortable:!1,minWidth:"120",show:!0},{label:"副标题",prop:"subtitle",align:"center",type:"string",sortable:!1,minWidth:"120",show:!0},{label:"上架价格TN",prop:"sale_price",align:"center",type:"string",sortable:!1,minWidth:"120",show:!0},{label:"商户报价TN",prop:"cost_price",align:"center",type:"string",sortable:!1,minWidth:"120",show:!0},{label:"排序",prop:"sort",align:"center",type:"string",sortable:!1,minWidth:"120",show:!0},{label:"推荐排序",prop:"tuijian_sort",align:"center",type:"string",sortable:!1,minWidth:"120",show:!0},{label:"精选排序",prop:"jingxuan_sort",align:"center",type:"string",sortable:!1,minWidth:"120",show:!0},{label:"创建时间",prop:"created_at",align:"center",type:"string",sortable:!1,minWidth:"160",show:!0},{label:"状态",prop:"status_text",align:"center",type:"string",sortable:!1,minWidth:"110",show:!0},{label:"操作",type:"button",btnList:[{label:"选择",type:"primary",auth:"admin/merchant/com_config/edit_save",handle:(e,a)=>Q(a)}],align:"center",sortable:!1,minWidth:"80",show:!0}]),M=async()=>{let e={merchant_type:F.value,...G.value,...A.value};const a=await i("/admin/merchant/goods/list",e);if(a&&(C.value=[],G.value=(null==a?void 0:a.page)||{},C.value.splice(0),a.list.length>0))for(let t=0;t<a.list.length;t++){let e={...a.list[t],isCheck:!1};C.value.push(e)}};M();const Q=e=>{L.value=e,E.value=JSON.parse(JSON.stringify(L.value)),k.value=!1},X=()=>{G.pageCurrent=1,M()},Y=()=>{T(A.value),A.value.status="all",G.value.page=1,G.value.page_size=1,M()};return(e,a)=>{const t=h,l=n("cusTable"),r=b,i=_;return s(),o(m,null,[p(y,{modelValue:j.value,"onUpdate:modelValue":a[0]||(a[0]=e=>j.value=e),formList:J.value,formData:W,rules:D,title:N.value,confirmValue:E.value,"label-position":"top",width:"950px",onSubmit:q},null,8,["modelValue","formList","formData","rules","title","confirmValue"]),p(i,{modelValue:k.value,"onUpdate:modelValue":a[2]||(a[2]=e=>k.value=e),width:"80vw"},{footer:d((()=>[u("div",v,[p(r,{onClick:a[1]||(a[1]=e=>k.value=!1)},{default:d((()=>a[3]||(a[3]=[c("关闭")]))),_:1})])])),default:d((()=>[u("div",null,[p(t,{searchForm:U.value,searchData:A.value,searchHandle:B.value,onHandleEnterSearch:X,onHandleReset:Y},null,8,["searchForm","searchData","searchHandle"]),p(l,{ref:"cusTable",height:"calc(100vh - 340px)","row-key":"id",isPagination:!0,tableCols:K.value,tableData:C.value,tablePage:G.value,onHandleCurrentChange:M},null,8,["tableCols","tableData","tablePage"])])])),_:1},8,["modelValue"])],64)}}},[["__scopeId","data-v-0346cddf"]]);export{f as default};
