import{f as e,g as a,T as t,y as l,ai as i,H as s,S as n,r as o,o as d,c as r,F as u,a2 as c,a as p,d as h,w as m,e as g,t as v,aw as b,D as _,aa as y}from"./index-BdR_P0jW.js";/* empty css                *//* empty css                                                                 */import f from"./add-lSMw_BYD.js";import x from"./goodsCheck-BpoXf0Nh.js";import{E as w}from"./index-C5CR2e01.js";/* empty css                */import"./index-PFFTJ-rA.js";/* empty css                    */import"./index-TSZus3Mb.js";import"./index-DIDL6cCO.js";import"./index-C5ggMqbd.js";const j={class:"boxElMain"},k={class:"box boxFlex"},W={class:"dialog-footer"},D=Object.assign({name:"localLife/goodsmanager/index"},{__name:"index",setup(D){const C=e({getList:"/admin/merchant/goods/list",save_submit:"/admin/merchant/goods/edit_save",getDetail:"/admin/merchant/goods/detail",checkGoods:"/admin/merchant/goods/audit"}),O=e("add"),S=a({}),H=e([{label:"全部",value:"all"},{label:"草稿",value:"0"},{label:"审核中",value:"1"},{label:"已上架",value:"2"},{label:"已下架",value:"3"},{label:"已通过",value:"4"},{label:"已驳回",value:"5"}]),T=e([]);(async()=>{const e=await l("/admin/merchant/index/select_list");T.value=(null==e?void 0:e.map((e=>({value:e.id,label:e.name,...e}))))||[]})();const V=e([{type:"Select",label:"商户名称",prop:"merchant_id",placeholder:"请输入",width:"180px",options:T},{type:"Input",label:"商品名称",prop:"keyword",placeholder:"请输入",width:"220px"},{type:"Select",label:"状态",prop:"status",width:"220px",options:H,placeholder:"请选择状态"},{type:"Select",label:"是否推荐",prop:"is_tuijian",width:"220px",options:[{label:"是",value:1},{label:"否",value:0}],placeholder:"请选择是否推荐"},{type:"Select",label:"是否精选",prop:"is_jingxuan",width:"220px",options:[{label:"是",value:1},{label:"否",value:0}],placeholder:"请选择是否精选"},{type:"DateRange",label:"创建时间",prop:"created_at",width:"280px"}]),P=e({id:"",merchant_id:"",merchant_type:"",status:"all",keyword:""}),R=e([{label:"查 询",icon:"Search",auth:"admin/merchant/goods/list",handle:()=>B()},{label:"重置",auth:"admin/merchant/goods/list",handle:()=>le()},{label:"排序",popover:!0}]),F=e([{label:"新增",icon:"Plus",auth:"admin/merchant/goods/edit_save",handle:()=>Q()}]),E=e({page:1,page_size:20}),N=e([{label:"ID",prop:"id",align:"center",type:"string",sortable:!1,minWidth:"80",show:!0},{label:"商户类型",prop:"merchant",align:"center",type:"object",subProp:"type_text",sortable:!1,minWidth:"120",show:!0},{label:"商户名称",prop:"merchant",align:"center",type:"object",subProp:"name",sortable:!1,minWidth:"120",show:!0},{label:"商品名称",prop:"goods_name",align:"center",type:"string",imgWidth:"35px",sortable:!1,minWidth:"120",show:!0},{label:"副标题",prop:"subtitle",align:"center",type:"string",sortable:!1,minWidth:"120",show:!0},{label:"上架价格TN",prop:"sale_price",align:"center",type:"string",sortable:!1,minWidth:"120",show:!0},{label:"商户报价TN",prop:"cost_price",align:"center",type:"string",sortable:!1,minWidth:"120",show:!0},{label:"排序",prop:"sort",align:"center",type:"string",sortable:!1,minWidth:"120",show:!0},{label:"是否推荐",prop:"is_tuijian_text",align:"center",type:"string",sortable:!1,minWidth:"120",show:!0},{label:"推荐排序",prop:"tuijian_sort",align:"center",type:"string",sortable:!1,minWidth:"120",show:!0},{label:"是否精选",prop:"is_jingxuan_text",align:"center",type:"string",sortable:!1,minWidth:"120",show:!0},{label:"精选排序",prop:"jingxuan_sort",align:"center",type:"string",sortable:!1,minWidth:"120",show:!0},{label:"创建时间",prop:"created_at",align:"center",type:"string",sortable:!1,minWidth:"160",show:!0},{label:"状态",prop:"status_text",align:"center",type:"string",sortable:!1,minWidth:"110",show:!0},{label:"操作",minWidth:"220",type:"button",show:!0,fixed:"right",align:"right",btnList:[{hide:e=>L(e),labelTextFn:e=>(e=>0===e.status?"提交审核":1===e.status?"审核":2===e.status?"下架":3===e.status||4===e.status?"上架":void 0)(e),typeFn:e=>(e=>2===e.status?"danger":3===e.status||4===e.status?"success":void 0)(e),auth:"admin/merchant/goods/update_status",handle:(e,a,t,l,i)=>ae(e,a)},{hide:e=>J(e),label:"编辑",type:"primary",auth:"admin/merchant/goods/edit_save",handle:(e,a,t,l,i)=>I(e,a)},{label:"查看",type:"primary",auth:"admin/merchant/goods/detail",handle:(e,a,t,l,i)=>G(e,a)}]}]),J=e=>2===e.status||1===e.status,L=e=>5===e.status;t.on("getCheckData",(e=>{(e=>{const a=[];e.list.forEach((e=>{a.push(e.label)})),N.value.sort(((e,t)=>"操作"===e.label?1:a.indexOf(e.label)-a.indexOf(t.label))),N.value=N.value.map((a=>e.data.includes(a.label)||"操作"===a.label?{...a,show:!0}:{...a,show:!1}))})(e)}));const B=()=>{E.value.page=1,$()},U=e=>{for(const a of Object.keys(e))delete e[a]},z=e(""),G=(e,a)=>{U(S),A(a.id,"check"),O.value="check",z.value="查看商品"},I=(e,a,t,l,i)=>{K.value="编辑商户",U(S),A(a.id,"notcheck"),O.value="edit"},A=async(e,a)=>{const t=await l(C.value.getDetail,{id:e});t&&(Object.assign(S,t),q.value="notcheck"===a,M.value="notcheck"!==a)},M=e(!1),Z=async e=>{if(!e)return M.value=!1,void U(S);let a={id:S.id,status:e.status,remark:e.remark};await l(C.value.checkGoods,a)&&(M.value=!1,U(S),$())},q=e(!1),K=e(""),Q=()=>{q.value=!0,O.value="add"},X=async e=>{var a,t,i,s,n,o,d;if(!e)return U(S),void(q.value=!1);let r=JSON.parse(JSON.stringify(e));r.goods_logo=(null==(a=e.goods_logo)?void 0:a.id)||(null==(t=e.goods_logo_url)?void 0:t.file_id),r.goods_img=null==(i=null==e?void 0:e.goods_img)?void 0:i.map((e=>e.id||e.file_id)),r.tuijian_img=(null==(s=e.tuijian_img)?void 0:s.id)||(null==(n=e.tuijian_img_url)?void 0:n.file_id),r.is_tuijian=e.is_tuijian||0,r.jingxuan_img=(null==(o=e.jingxuan_img)?void 0:o.id)||(null==(d=e.jingxuan_img_url)?void 0:d.file_id),r.is_jingxuan=e.is_jingxuan||0,await l(C.value.save_submit,r)&&(U(S),q.value=!1,$())},Y=e([]),$=async()=>{let e=JSON.parse(JSON.stringify(P.value));"object"==typeof(null==e?void 0:e.merchant_type)&&1===(null==e?void 0:e.merchant_type.length)?e.merchant_type=null==e?void 0:e.merchant_type[0]:"object"==typeof(null==e?void 0:e.merchant_type)&&(null==e?void 0:e.merchant_type.length)>1&&(e.merchant_type=null==e?void 0:e.merchant_type[1]);const a=await l(C.value.getList,{...E.value,...e});if(a&&(Y.value=[],E.value.total=a.page.total||0,Y.value.splice(0),a.list.length>0))for(let t=0;t<a.list.length;t++){let e=a.list[t];Y.value.push(e)}},ee=e(!1),ae=async(e,a,t,n,o)=>{0===a.status?i.alert("确定将该商品提交审核吗？","提示",{confirmButtonText:"确定",callback:async e=>{if("confirm"===e){await l("/admin/merchant/goods/update_status",{id:a.id,status:1})&&(s.success("提交审核成功"),$())}}}):1===a.status?((e,a)=>{U(S),A(a.id,"check"),z.value="商品审核"})(0,a):2===a.status?i.alert("确定下架此商品吗？","提示",{confirmButtonText:"确定",callback:async e=>{if("confirm"===e){await l("/admin/merchant/goods/update_status",{id:a.id,status:3})&&(s.success("下架成功"),$())}}}):3!==a.status&&4!==a.status||i.alert("确定上架此商品吗？","提示",{confirmButtonText:"确定",callback:async e=>{if("confirm"===e){await l("/admin/merchant/goods/update_status",{id:a.id,status:2})&&(s.success("上架成功"),$())}}})},te=()=>{ee.value=!1};n((()=>{$()}));const le=()=>{U(P.value),P.value.status="all",E.value.page=1,E.value.page_size=20,$()};return(e,a)=>{const t=b,l=o("cusTable"),i=w,s=_,n=y;return d(),r("div",null,[u(p("div",j,[p("div",k,[h(i,null,{default:m((()=>[h(t,{searchForm:V.value,searchData:P.value,searchHandleRight:F.value,searchHandle:R.value,tableCols:N.value,onHandleEnterSearch:B,onHandleReset:le},null,8,["searchForm","searchData","searchHandleRight","searchHandle","tableCols"]),h(l,{ref:"cusTable",height:"calc(100vh - 240px)","row-key":"id",isPagination:!0,isHandle:!0,tableCols:N.value,tableData:Y.value,tablePage:E.value,onHandleCurrentChange:$},null,8,["tableCols","tableData","tablePage"])])),_:1})]),h(n,{modelValue:ee.value,"onUpdate:modelValue":a[1]||(a[1]=e=>ee.value=e),title:"提示",width:"500"},{footer:m((()=>[p("div",W,[h(s,{onClick:a[0]||(a[0]=e=>ee.value=!1)},{default:m((()=>a[4]||(a[4]=[g("取消")]))),_:1}),h(s,{type:"primary",onClick:te},{default:m((()=>a[5]||(a[5]=[g(" 确定 ")]))),_:1})])])),default:m((()=>[p("span",null,"确定要"+v(1===S.status?"禁用":"启用")+"该类型吗",1)])),_:1},8,["modelValue"])],512),[[c,!(q.value||M.value)]]),h(f,{modelValue:q.value,"onUpdate:modelValue":a[2]||(a[2]=e=>q.value=e),onCloseAddPage:X,addOrEdit:O.value,selectedRowData:S},null,8,["modelValue","addOrEdit","selectedRowData"]),h(x,{modelValue:M.value,"onUpdate:modelValue":a[3]||(a[3]=e=>M.value=e),onCloseCheckPage:Z,selectedRowData:S,title:z.value},null,8,["modelValue","selectedRowData","title"])])}}});export{D as default};
