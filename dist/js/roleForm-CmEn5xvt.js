import{a6 as e,a7 as a,R as l,f as s,g as t,h as o,j as d,o as i,L as r,w as n,d as u,a as c,c as _,J as m,K as p,e as f,t as v,y as h,H as b,au as y,B as g,A as k,ad as V,ae as w,D as x,E as j,aa as O}from"./index-BdR_P0jW.js";/* empty css                */import{E as R}from"./index-D1LW7kyL.js";import"./index-SLBSEZ_O.js";const U={key:1,class:"text-red",draggable:"true"},C={__name:"roleForm",props:e({data:{type:Object,default:()=>({})}},{modelValue:{},modelModifiers:{}}),emits:e(["submit"],["update:modelValue"]),setup(e,{emit:C}){const D=a(e,"modelValue"),K=C,z=e,E=l((()=>(z.data.role_id?"编辑":"新增")+"角色")),q=l((()=>z.data.role_id)),A={checkStrictly:!0,label:"role_name",value:"role_id",children:"children"},B=s([]),F=s([]),H={label:"access_name",value:"access_id",children:"children"},J=s(null),L=s(null),M=s(null),S=t({access_list:[]}),Y=async e=>{if(e){loading.value=!0;let a={page:1,page_size:999,mobile:e,status:1};const l=await h("/admin/users/index/lists",a);l&&(loading.value=!1,userOptions.value=l.lists.list.map((e=>({value:e.id,label:e.mobile+" / "+e.nickname}))))}else userOptions.value=[]},G=t({role_name:[{required:!0,message:"请输入名称",trigger:"blur"}]});o(D,(async e=>{if(!e)return void P(S);const a=q.value??0,l=await d("/admin/role/edit/"+a,{parent_role_id:0});if(!l)return;const{role:s,role_list:t,access_list:o,role_access_ids:i}=l||{};P(S),Object.assign(S,s),i.push(1),S.access_list=i,B.value=[{role_name:"无",role_id:0,option_index:0}].concat(t),o[0].disabled=!0,F.value=o}));const I=e=>{S.parent_role_id=e.length>0?e[e.length-1]:"",""!==S.parent_role_id?(async e=>{const a=await d("/admin/role/edit/"+e,{parent_role_id:e}),l=(null==a?void 0:a.role_list)||[];B.value=[{role_name:"无",role_id:0,option_index:0}].concat(l),F.value=(null==a?void 0:a.access_list)||[],F.value[0].disabled=!0})(S.parent_role_id):F.value=[]},N=(e,a)=>{M.value=a.halfCheckedKeys,Object.assign(S,{access_list:a.checkedKeys})},P=e=>{for(const a of Object.keys(e))delete e[a];S.access_list=[]},Q=async()=>{let e=[];M.value&&(e=M.value.concat(S.access_list));let a={...S};e.length>0&&(a.access_list=e.sort(((e,a)=>e-a)));await h("/admin/role/edit",a)&&(b.success((z.data.role_id?"修改":"添加")+"成功"),K("submit"),D.value=!1)};return(e,a)=>{const l=y,s=g,t=k,o=V,d=w,h=R,C=x,K=j,q=O;return i(),r(q,{modelValue:D.value,"onUpdate:modelValue":a[5]||(a[5]=e=>D.value=e),title:E.value,width:"420",top:"20vh",class:"form-dialog","close-on-click-modal":!1},{default:n((()=>[u(K,{ref_key:"formDataRef",ref:L,model:S,"label-width":"auto",rules:G},{default:n((()=>[u(s,{label:"上级权限",prop:"formData.parent_role_id"},{default:n((()=>[u(l,{options:B.value,props:A,modelValue:S.parent_role_id,"onUpdate:modelValue":a[0]||(a[0]=e=>S.parent_role_id=e),clearable:"",onChange:I,style:{width:"100%"}},null,8,["options","modelValue"]),a[6]||(a[6]=c("span",{class:"text-muted"},"父级角色，角色最多三级",-1))])),_:1}),u(s,{label:"名称",prop:"role_name"},{default:n((()=>[u(t,{modelValue:S.role_name,"onUpdate:modelValue":a[1]||(a[1]=e=>S.role_name=e)},null,8,["modelValue"])])),_:1}),u(s,{label:"商户名称",prop:"role_name"},{default:n((()=>[u(d,{modelValue:S.merchant_id,"onUpdate:modelValue":a[2]||(a[2]=e=>S.merchant_id=e),filterable:"",remote:"","reserve-keyword":"",placeholder:"输入名称查询","remote-method":Y,loading:e.loading},{default:n((()=>[(i(!0),_(m,null,p(e.userOptions,(e=>(i(),r(o,{key:e.value,label:e.label,value:e.value},null,8,["label","value"])))),128))])),_:1},8,["modelValue","loading"])])),_:1}),u(s,{label:"描述",prop:"description"},{default:n((()=>[u(t,{style:{width:"100%"},modelValue:S.description,"onUpdate:modelValue":a[3]||(a[3]=e=>S.description=e),autosize:{minRows:2,maxRows:4},type:"textarea",placeholder:"请输入描述"},null,8,["modelValue"])])),_:1}),u(s,{label:"权限",prop:"params"},{default:n((()=>[S.parent_role_id||S.parent_role_id>=0?(i(),r(h,{key:0,ref_key:"treeRef",ref:J,data:F.value,"show-checkbox":"","node-key":"access_id","default-checked-keys":S.access_list,props:H,onCheck:N},null,8,["data","default-checked-keys"])):(i(),_("span",U,"请选择父级角色"))])),_:1}),u(s,{class:"text-right"},{default:n((()=>[u(C,{type:"primary",onClick:a[4]||(a[4]=e=>(async e=>{e&&e.validate((e=>{if(e){if(!S.access_list.length)return void b({message:"权限分配不能为空",type:"error"});Q()}}))})(L.value))},{default:n((()=>[f(" 立即"+v(z.data.role_id?"修改":"添加"),1)])),_:1})])),_:1})])),_:1},8,["model","rules"])])),_:1},8,["modelValue","title"])}}};export{C as default};
